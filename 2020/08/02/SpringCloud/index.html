<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="晓江"><meta name="copyright" content="晓江"><meta name="generator" content="Hexo 5.0.0"><meta name="theme" content="hexo-theme-yun"><title>SpringCloud | 云端小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.16/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://cdn.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><link rel="shortcut icon" type="image/svg+xml" href="/icon.jpg"><link rel="mask-icon" href="/icon.jpg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="云端小站" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"云端小站","version":"0.9.4","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"}};
  </script><meta name="description" content="SpringCloud1、简介 解决方案：  SpringCloud 生态   SpringCloud NetFlix 一站式解决方案！ api网关，zuul组件 Feign —— httpClient —— Http通信方式，同步，阻塞 服务注册发现：Eureka 熔断机制：Hystrix （2018年停更的）    Apache Dubbo zookeeper 半自动，需要整合别人的 API：">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud">
<meta property="og:url" content="http://yoursite.com/2020/08/02/SpringCloud/index.html">
<meta property="og:site_name" content="云端小站">
<meta property="og:description" content="SpringCloud1、简介 解决方案：  SpringCloud 生态   SpringCloud NetFlix 一站式解决方案！ api网关，zuul组件 Feign —— httpClient —— Http通信方式，同步，阻塞 服务注册发现：Eureka 熔断机制：Hystrix （2018年停更的）    Apache Dubbo zookeeper 半自动，需要整合别人的 API：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730174923118.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730110910772.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730111506786.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730113202994.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730114601511.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730120013761.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730120121944.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730133313657.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730143802527.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730144012036.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730144134151.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730161155433.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730161235040.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730165832903.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730170620516.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730174727048.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20190703102014756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F3ZTg2MzE0,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730221150033.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731102547529.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731102848470.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731103046705.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731103125811.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731104331435.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731104308003.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731111733911.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731111908854.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731112030892.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731113941440.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731121057217.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731121354205.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731125532701.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731124133143.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731120033021.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731124719543.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731125142475.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731124942479.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731125351923.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731130600612.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731134003657.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731142103249.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731142555064.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731143357873.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731143548473.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731143832503.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731145316004.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731151422655.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731151508656.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731151546458.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731164333644.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731163146688.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731165125164.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731165951172.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200731183351047.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801105816572.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801114921776.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801114833325.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801120913812.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801130145311.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801130227685.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801133128840.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801152738823.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801152820894.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801153011869.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801152549620.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801153546084.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801154019115.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801153701943.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801153836448.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801170826742.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801154518122.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801155409190.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801163000754.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801163043791.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801163245212.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801163834026.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801163814040.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801164219768.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801164644932.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801165957432.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801194254910.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801215607431.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801221259049.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801224244058.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801225244514.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801225123260.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801230901167.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801232501527.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801233031253.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801233919518.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200801234042999.png">
<meta property="og:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200802102428335.png">
<meta property="article:published_time" content="2020-08-02T12:47:30.000Z">
<meta property="article:modified_time" content="2020-08-04T06:23:17.749Z">
<meta property="article:author" content="晓江">
<meta property="article:tag" content="java">
<meta property="article:tag" content="spring">
<meta property="article:tag" content="微服务">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/08/02/SpringCloud/image-20200730174923118.png"><script src="/js/ui/mode.js"></script></head><body><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="晓江"><img width="96" loading="lazy" src="/icon.jpg" alt="晓江"></a><div class="site-author-name"><a href="/about/">晓江</a></div><a class="site-name" href="/about/site.html">云端小站</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">20</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">7</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://lxjblog.gitee.io/myblog" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1256240778&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/lxjnote" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:1256240778@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringCloud"><span class="toc-text">SpringCloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">1、简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0"><span class="toc-text">2、微服务概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.1、什么是微服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text">2.2、微服务与微服务架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">2.3、微服务优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4%E3%80%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-text">2.4、微服务技术栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%80%89%E6%8B%A9SpringCloud%E4%BD%9C%E4%B8%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="toc-text">2.5、为什么要选择SpringCloud作为微服务架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E5%9E%8B%E4%BE%9D%E6%8D%AE"><span class="toc-text">选型依据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E5%90%84%E5%A4%A7IT%E5%85%AC%E5%8F%B8%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-text">当前各大IT公司的微服务架构有哪些</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94"><span class="toc-text">各微服务框架对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81SpringCloud%E5%85%A5%E9%97%A8%E6%A6%82%E8%BF%B0"><span class="toc-text">3、SpringCloud入门概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81SpringCloud%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">3.1、SpringCloud是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81SpringCloud%E5%92%8CSpringBoot%E5%85%B3%E7%B3%BB"><span class="toc-text">3.2、SpringCloud和SpringBoot关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81Dubbo%E5%92%8CSpringCloud%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-text">3.3、Dubbo和SpringCloud技术选型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F-%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86Dubbo"><span class="toc-text">分布式+服务治理Dubbo</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dubbo%E5%92%8CSpringCloud%E5%AF%B9%E6%AF%94"><span class="toc-text">Dubbo和SpringCloud对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringCould%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-text">SpringCould能干嘛</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81SpringCloud%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-text">4、SpringCloud项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E5%88%9B%E5%BB%BA%E7%88%B6%E9%A1%B9%E7%9B%AE"><span class="toc-text">4.1、创建父项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81%E5%88%9B%E5%BB%BAAPI%E6%A8%A1%E5%9D%97"><span class="toc-text">4.2、创建API模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81%E5%88%9B%E5%BB%BA%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-text">4.3、创建提供者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E3%80%81%E5%88%9B%E5%BB%BA%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">4.4、创建消费者</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81Eureka%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0"><span class="toc-text">5、Eureka服务注册与发现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFEureka%EF%BC%88%E5%B0%A4%E9%87%8C%E5%8D%A1%EF%BC%89"><span class="toc-text">5.1、什么是Eureka（尤里卡）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E3%80%81%E5%8E%9F%E7%90%86%E8%AE%B2%E8%A7%A3"><span class="toc-text">5.2、原理讲解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E3%80%81%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-text">5.3、创建一个注册中心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4%E3%80%81%E8%BF%9B%E8%A1%8C%E6%B3%A8%E5%86%8C"><span class="toc-text">5.4、进行注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5%E3%80%81Eureka%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-text">5.5、Eureka集群配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6%E3%80%81Eureka%E4%B8%8EZookeeper%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">5.6、Eureka与Zookeeper的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CAP%E5%8E%9F%E5%88%99"><span class="toc-text">CAP原则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Eureka%E4%B8%8EZookeeper%E5%AF%B9%E6%AF%94"><span class="toc-text">Eureka与Zookeeper对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-text">6、Ribbon负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%E3%80%81Ribbon%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">6.1、Ribbon是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%E3%80%81Ribbon%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-text">6.2、Ribbon集成测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.3、负载均衡的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95"><span class="toc-text">6.4、自定义负载均衡算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81Feign%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B"><span class="toc-text">7、Feign接口编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-text">7.1、简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2%E3%80%81Feign%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-text">7.2、Feign使用步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81Hystrix%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6"><span class="toc-text">8、Hystrix保护机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFHystrix-%E8%B1%AA%E7%8C%AA"><span class="toc-text">8.1、什么是Hystrix(豪猪)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2%E3%80%81%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD"><span class="toc-text">8.2、服务熔断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3%E3%80%81%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="toc-text">8.3、服务降级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4%E3%80%81Dashboard%E6%B5%81%E7%9B%91%E6%8E%A7"><span class="toc-text">8.4、Dashboard流监控</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%90%AB%E4%B9%89"><span class="toc-text">内容含义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%9C%86"><span class="toc-text">一圆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E7%BA%BF"><span class="toc-text">一线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%9B%BE%E8%AF%B4%E6%98%8E"><span class="toc-text">整图说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81Zuul%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3"><span class="toc-text">9、Zuul路由网关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFZuul"><span class="toc-text">9.1、什么是Zuul</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2%E3%80%81%E9%A1%B9%E7%9B%AE%E6%B5%8B%E8%AF%95"><span class="toc-text">9.2、项目测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3%E3%80%81%E8%B7%AF%E7%94%B1%E7%BD%91%E5%85%B3%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">9.3、路由网关的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B5%8B%E8%AF%95"><span class="toc-text">开启测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81SpringCloud-Config%E9%85%8D%E7%BD%AE"><span class="toc-text">10、SpringCloud Config配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text">10.1、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">10.2、环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3%E3%80%81Config%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">10.3、Config客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4%E3%80%81%E8%BF%9C%E7%A8%8B%E9%85%8D%E7%BD%AE%E5%AE%9E%E6%88%98"><span class="toc-text">10.4、远程配置实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%8A%E4%BC%A0"><span class="toc-text">代码上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-text">获取文件</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/02/SpringCloud/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="晓江"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="云端小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SpringCloud</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-08-02 20:47:30" itemprop="dateCreated datePublished" datetime="2020-08-02T20:47:30+08:00">2020-08-02</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2020-08-04 14:23:17" itemprop="dateModified" datetime="2020-08-04T14:23:17+08:00">2020-08-04</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">微服务</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/java/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">java</span></a><a class="tag" href="/tags/spring/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">spring</span></a><a class="tag" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">微服务</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p><img src="/2020/08/02/SpringCloud/image-20200730174923118.png" alt="image-20200730174923118" loading="lazy"></p>
<p>解决方案：</p>
<blockquote>
<p>SpringCloud 生态</p>
</blockquote>
<ol>
<li><p>SpringCloud NetFlix 一站式解决方案！</p>
<p>api网关，zuul组件</p>
<p>Feign —— httpClient —— Http通信方式，同步，阻塞</p>
<p>服务注册发现：Eureka</p>
<p>熔断机制：Hystrix</p>
<p>（2018年停更的）</p>
</li>
</ol>
<ol start="2">
<li><p>Apache Dubbo zookeeper 半自动，需要整合别人的</p>
<p>API：没有，找第三方组件，或者自己实现</p>
<p>Dubbo</p>
<p>zookeeper</p>
<p>熔断机制：借助Hystrix</p>
<p>Dubbo并不完善~</p>
</li>
</ol>
<ol start="3">
<li><p>SpringCloud Alibaba 一站式解决方案！</p>
<p>新创建的</p>
</li>
</ol>
<p>新概念：服务网格 Server Mesh  </p>
<blockquote>
<p>解决的问题：</p>
</blockquote>
<ol>
<li>API</li>
<li>HTTP，RPC</li>
<li>注册和发现</li>
<li>熔断机制</li>
</ol>
<p>原因：网络不可靠</p>
<p><img src="/2020/08/02/SpringCloud/image-20200730110910772.png" alt="image-20200730110910772" loading="lazy"></p>
<h2 id="2、微服务概述"><a href="#2、微服务概述" class="headerlink" title="2、微服务概述"></a>2、微服务概述</h2><h3 id="2-1、什么是微服务"><a href="#2-1、什么是微服务" class="headerlink" title="2.1、什么是微服务"></a>2.1、什么是微服务</h3><p>维基上对其定义为：一种软件开发技术- 面向服务的体系结构（SOA）架构样式的一种变体，将应用程序构造为一组松散耦合的服务。在微服务体系结构中，服务是细粒度的，协议是轻量级的。</p>
<p>微服务（或微服务架构）是一种云原生架构方法，其中单个应用程序由许多松散耦合且可独立部署的较小组件或服务组成。这些服务通常</p>
<ul>
<li>有自己的堆栈，包括数据库和数据模型；</li>
<li>通过REST API，事件流和消息代理的组合相互通信；</li>
<li>它们是按业务能力组织的，分隔服务的线通常称为有界上下文。</li>
<li>可以更轻松地更新代码。</li>
<li>团队可以为不同的组件使用不同的堆栈。</li>
<li>模块化，可以使用不同的语言来编写服务，也可以使用不同是数据存储</li>
</ul>
<p><img src="/2020/08/02/SpringCloud/image-20200730111506786.png" alt="image-20200730111506786" loading="lazy"></p>
<h3 id="2-2、微服务与微服务架构"><a href="#2-2、微服务与微服务架构" class="headerlink" title="2.2、微服务与微服务架构"></a>2.2、微服务与微服务架构</h3><p><strong>微服务</strong></p>
<p>强调的是服务的大小，关注的是某一个点，是具体解决某一个问题对应的一个服务应用，狭义的看，可以看做是IDEA中的一个个微服务工程或者Moudel</p>
<p><strong>微服务架构</strong></p>
<p>一种新的架构形式，Martin Fowler，2014年提出</p>
<p>微服务架构是一种架构模式，它提倡将单一应用程序划分成一组小的服务，使服务之间相互协调，互相配合，为用户提供最终的价值。对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。</p>
<h3 id="2-3、微服务优缺点"><a href="#2-3、微服务优缺点" class="headerlink" title="2.3、微服务优缺点"></a>2.3、微服务优缺点</h3><p><strong>优点</strong></p>
<ul>
<li>单一职责原则</li>
<li>每个服务足够内聚，足够小，代码容易理解，缺一不可</li>
<li>开发简单，开发效率提高，一个服务可能就是专一的干一件事</li>
<li>微服务能够被小团队单独开发，这个小团队是2~5人的开发人员组成</li>
<li>微服务是松耦合，有功能意义的服务，都是独立的</li>
<li>可以使用不同的语言开发</li>
<li>易于和第三方集成，微服务允许容易且灵活的方式集成自动部署，如jenkins，Hudson，bamboo</li>
<li><strong>微服务是业务逻辑的代码，不会和HTML，CSS或其他界面混合</strong></li>
<li><strong>每个微服务有自己的存储能力，可以有自己的数据库，也可以有统一数据库</strong></li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>开发人员要处理分布式系统的复杂性</li>
<li>随着服务的增加，运维的压力也在增大</li>
<li>系统部署依赖</li>
<li>服务间通信成本</li>
<li>数据一致性</li>
<li>系统集成测试</li>
<li>性能监控</li>
</ul>
<h3 id="2-4、微服务技术栈"><a href="#2-4、微服务技术栈" class="headerlink" title="2.4、微服务技术栈"></a>2.4、微服务技术栈</h3><p><img src="/2020/08/02/SpringCloud/image-20200730113202994.png" alt="image-20200730113202994" loading="lazy"></p>
<h3 id="2-5、为什么要选择SpringCloud作为微服务架构"><a href="#2-5、为什么要选择SpringCloud作为微服务架构" class="headerlink" title="2.5、为什么要选择SpringCloud作为微服务架构"></a>2.5、为什么要选择SpringCloud作为微服务架构</h3><blockquote>
<h4 id="选型依据"><a href="#选型依据" class="headerlink" title="选型依据"></a>选型依据</h4></blockquote>
<ul>
<li>整体解决方案和框架成熟度</li>
<li>社区热度</li>
<li>可维护性</li>
<li>学习曲线 </li>
</ul>
<blockquote>
<h4 id="当前各大IT公司的微服务架构有哪些"><a href="#当前各大IT公司的微服务架构有哪些" class="headerlink" title="当前各大IT公司的微服务架构有哪些"></a>当前各大IT公司的微服务架构有哪些</h4></blockquote>
<ul>
<li>阿里：dubbo+HFS</li>
<li>京东：JSF</li>
<li>新浪：Motan</li>
<li>当当网：DubboX</li>
<li>……</li>
</ul>
<blockquote>
<h4 id="各微服务框架对比"><a href="#各微服务框架对比" class="headerlink" title="各微服务框架对比"></a>各微服务框架对比</h4></blockquote>
<ul>
<li>SpringCloud NetFlix 一站式解决方案，但不再维护！</li>
<li>Apache Dubbo zookeeper 半自动，需要整合别人的</li>
<li>SpringCloud Alibaba 一站式解决方案，新产品！</li>
</ul>
<h2 id="3、SpringCloud入门概述"><a href="#3、SpringCloud入门概述" class="headerlink" title="3、SpringCloud入门概述"></a>3、SpringCloud入门概述</h2><h3 id="3-1、SpringCloud是什么"><a href="#3-1、SpringCloud是什么" class="headerlink" title="3.1、SpringCloud是什么"></a>3.1、SpringCloud是什么</h3><p>官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></p>
<p>中文文档：<a target="_blank" rel="noopener" href="https://www.springcloud.cc/">https://www.springcloud.cc/</a></p>
<p>SpringCloud：<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-cloud-dalton.html">https://www.springcloud.cc/spring-cloud-dalton.html</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730114601511.png" alt="image-20200730114601511" loading="lazy"></p>
<p>Spring Cloud为开发人员提供了工具，以快速构建分布式系统中的某些常见模式（例如，配置管理，服务发现，断路器，智能路由，微代理，控制总线，一次性令牌，全局锁，领导选举，分布式会话，群集状态）。分布式系统的协调导致样板式样，并且使用Spring Cloud开发人员可以快速站起来实现这些样板的服务和应用程序。</p>
<p>Spring Cloud专注于为典型的用例和扩展机制（包括其他用例）提供良好的开箱即用体验。</p>
<h3 id="3-2、SpringCloud和SpringBoot关系"><a href="#3-2、SpringCloud和SpringBoot关系" class="headerlink" title="3.2、SpringCloud和SpringBoot关系"></a>3.2、SpringCloud和SpringBoot关系</h3><ul>
<li>SpringBoot专注于快速方便的开发单个个体微服务</li>
<li>SpringCloud是关注全局的微服务协调整理治理框架，它将SpringBoot开发的一个个单体微服务整合并管理起来，为各个为服务之间提供：配置管理，服务发现，断路器，路由，微代理，事件总线，全局锁，决策竞选，分布式会话等等集成服务</li>
<li>SpringBoot可以离开SpringCloud独立使用，开发项目，但是SpringCloud离不开SpringBoot，属于依赖关系</li>
<li><strong>SpringBoot专注于快速、方便的开发单个个体微服务，SpringCloud关注全局的服务治理框架</strong></li>
</ul>
<h3 id="3-3、Dubbo和SpringCloud技术选型"><a href="#3-3、Dubbo和SpringCloud技术选型" class="headerlink" title="3.3、Dubbo和SpringCloud技术选型"></a>3.3、Dubbo和SpringCloud技术选型</h3><blockquote>
<h4 id="分布式-服务治理Dubbo"><a href="#分布式-服务治理Dubbo" class="headerlink" title="分布式+服务治理Dubbo"></a>分布式+服务治理Dubbo</h4></blockquote>
<p>目前成熟的互联网架构：应用服务化拆分+消息中间件</p>
<p><img src="/2020/08/02/SpringCloud/image-20200730120013761.png" alt="image-20200730120013761" loading="lazy"></p>
<blockquote>
<h4 id="Dubbo和SpringCloud对比"><a href="#Dubbo和SpringCloud对比" class="headerlink" title="Dubbo和SpringCloud对比"></a>Dubbo和SpringCloud对比</h4></blockquote>
<p><img src="/2020/08/02/SpringCloud/image-20200730120121944.png" alt="image-20200730120121944" loading="lazy"></p>
<blockquote>
<h4 id="SpringCould能干嘛"><a href="#SpringCould能干嘛" class="headerlink" title="SpringCould能干嘛"></a>SpringCould能干嘛</h4></blockquote>
<p>Spring Cloud专注于为典型的用例和扩展机制（包括其他用例）提供良好的开箱即用体验。</p>
<ul>
<li>分布式/版本化配置</li>
<li>服务注册和发现</li>
<li>路由</li>
<li>服务到服务的呼叫</li>
<li>负载均衡</li>
<li>断路器</li>
<li>全局锁</li>
<li>领导选举和集群状态</li>
<li>分布式消息传递</li>
</ul>
<h2 id="4、SpringCloud项目搭建"><a href="#4、SpringCloud项目搭建" class="headerlink" title="4、SpringCloud项目搭建"></a>4、SpringCloud项目搭建</h2><p><strong>实际开发版本关系</strong></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730133313657.png" alt="image-20200730133313657" loading="lazy"></p>
<table>
<thead>
<tr>
<th>Spring Cloud</th>
<th>Spring Boot</th>
</tr>
</thead>
<tbody><tr>
<td>Angel版本</td>
<td>兼容Spring Boot 1.2.x</td>
</tr>
<tr>
<td>Brixton版本</td>
<td>兼容Spring Boot 1.3.x，也兼容Spring Boot 1.4.x</td>
</tr>
<tr>
<td>Camden版本</td>
<td>兼容Spring Boot 1.4.x，也兼容Spring Boot 1.5.x</td>
</tr>
<tr>
<td>Dalston版本、Edgware版本</td>
<td>兼容Spring Boot 1.5.x，不兼容Spring Boot 2.0.x</td>
</tr>
<tr>
<td>Finchley版本</td>
<td>兼容Spring Boot 2.0.x，不兼容Spring Boot 1.5.x</td>
</tr>
<tr>
<td>Greenwich版本</td>
<td>兼容Spring Boot 2.1.x</td>
</tr>
</tbody></table>
<p>在实际开发过程中，我们需要更详细的版本对应：</p>
<table>
<thead>
<tr>
<th>Spring Boot</th>
<th>Spring Cloud</th>
</tr>
</thead>
<tbody><tr>
<td>1.5.2.RELEASE</td>
<td>Dalston.RC1</td>
</tr>
<tr>
<td>1.5.9.RELEASE</td>
<td>Edgware.RELEASE</td>
</tr>
<tr>
<td>2.0.2.RELEASE</td>
<td>Finchley.BUILD-SNAPSHOT</td>
</tr>
<tr>
<td>2.0.3.RELEASE</td>
<td>Finchley.RELEASE</td>
</tr>
</tbody></table>
<h3 id="4-1、创建父项目"><a href="#4-1、创建父项目" class="headerlink" title="4.1、创建父项目"></a>4.1、创建父项目</h3><ol>
<li><p>创建普通Maven项目<code>SpringCloud</code>，作为父项目</p>
</li>
<li><p>修改<code>pom.xml</code>文件，编写打包方式</p>
</li>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 打包方式 pom --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.16.10<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.16.10<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SpringCloud依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Greenwich.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBoot依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库mysql --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.23<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--SpringBoot启动器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- junit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从上方取依赖版本 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Lombok --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从上方取依赖版本 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- log4j --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从上方取依赖版本 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- logback --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从上方取依赖版本 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-2、创建API模块"><a href="#4-2、创建API模块" class="headerlink" title="4.2、创建API模块"></a>4.2、创建API模块</h3><ol>
<li><p>新建一个moudle，<code>springcloud-api</code></p>
</li>
<li><p>在子项目的pom文件中导入依赖，因为父项目使用的是<code>&lt;/dependencyManagement&gt;</code>方式导入的</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建数据库<code>DB01</code></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730143802527.png" alt="image-20200730143802527" loading="lazy"></p>
</li>
<li><p>在IDEA中连接并创建数据表<code>dept</code></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730144012036.png" alt="image-20200730144012036" loading="lazy"></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730144134151.png" alt="image-20200730144134151" loading="lazy"></p>
</li>
<li><p>对应的sql为</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept</span><br><span class="line">(</span><br><span class="line">    deptno <span class="built_in">bigint</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    dname <span class="built_in">varchar</span>(<span class="number">60</span>),</span><br><span class="line">    db_source <span class="built_in">varchar</span>(<span class="number">60</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dept <span class="keyword">COMMENT</span> = <span class="string">&#x27;部门表&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (dname, db_source) <span class="keyword">values</span> (<span class="string">&#x27;开发部&#x27;</span>, <span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (dname, db_source) <span class="keyword">values</span> (<span class="string">&#x27;人事部&#x27;</span>, <span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (dname, db_source) <span class="keyword">values</span> (<span class="string">&#x27;财务部&#x27;</span>, <span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (dname, db_source) <span class="keyword">values</span> (<span class="string">&#x27;市场部&#x27;</span>, <span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (dname, db_source) <span class="keyword">values</span> (<span class="string">&#x27;运营部&#x27;</span>, <span class="keyword">DATABASE</span>());</span><br></pre></td></tr></table></figure>
</li>
<li><p>在目录<code>com.xj.springcloud.pojo</code>下创建实体类<code>Dept</code>，需要实现Serializable序列化，防止传输报错</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span> <span class="comment">// 开启链式写法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dept</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long deptno;</span><br><span class="line">    <span class="keyword">private</span> String dname;</span><br><span class="line">    <span class="comment">// 这个数据存在哪个数据库中的字段，微服务，一个服务对应一个数据库</span></span><br><span class="line">    <span class="keyword">private</span> String db_source;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dept</span><span class="params">(String dname)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dname = dname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    链式写法：</span></span><br><span class="line"><span class="comment">        Dept dept = new Dept();</span></span><br><span class="line"><span class="comment">        dept.setDeptno(11).setDname(&quot;sss&quot;).setDb_source(&quot;001&quot;);</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个服务到这里就可以了</p>
</li>
</ol>
<h3 id="4-3、创建提供者"><a href="#4-3、创建提供者" class="headerlink" title="4.3、创建提供者"></a>4.3、创建提供者</h3><ol>
<li><p>新创建一个模块<code>springcloud-provider-dept-8001</code></p>
</li>
<li><p>导入依赖，其中的实体类点进去可以到达我们刚才写的实体类</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--拿到我们需要的实体类api--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springcloud-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--junit--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--logback-core--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jetty--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--热部署工具--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xj.springcloud.pojo</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-provider-dept</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db01?serverTimezone=GMT&amp;createDatabaseIfNotExist=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;autoReconnect=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写<code>mybatis-config.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--开启二级缓存--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在目录<code>com.xj.springcloud.mapper</code>下创建<code>DeptMapper</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeptMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addDept</span><span class="params">(Dept dept)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">queryById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">queryAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写Mapper映射文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xj.springcloud.mapper.DeptMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addDept&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        insert into dept (dname, db_source)</span><br><span class="line">        values (#&#123;dename&#125;,DATABASE());</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Long&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        select * from dept where deptno=#&#123;deptno&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        select * from dept</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写业务类<code>DeptService</code>接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeptService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addDept</span><span class="params">(Dept dept)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">queryById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">queryAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写业务类<code>DeptServiceImpl</code>实现类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title">DeptService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addDept</span><span class="params">(Dept dept)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deptMapper.addDept(dept);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">queryById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deptMapper.queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">queryAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deptMapper.queryAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写控制类<code>DeptController</code>，提供Restful格式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 提供RestFul服务</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 调用业务层</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/dept/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addDept</span><span class="params">(Dept dept)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deptService.addDept(dept);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">getDept</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deptService.queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">queryAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> deptService.queryAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建主启动类<code>DeptProvider_8001</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 启动类</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptProvider_8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptProvider_8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动项目测试</p>
<p><img src="/2020/08/02/SpringCloud/image-20200730161155433.png" alt="image-20200730161155433" loading="lazy"></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730161235040.png" alt="image-20200730161235040" loading="lazy"></p>
<p>可以发现，在该项目中，我们没有编写任何前端代码。并且在第二个项目中也没有编写实体类，是调用第一个项目的。</p>
</li>
</ol>
<h3 id="4-4、创建消费者"><a href="#4-4、创建消费者" class="headerlink" title="4.4、创建消费者"></a>4.4、创建消费者</h3><blockquote>
<p>80端口代表本地，在测试的时候可以不写端口号</p>
</blockquote>
<ol>
<li><p>创建模块<code>springcloud-consumer-dept-80</code></p>
</li>
<li><p>导入依赖，不需要数据库，只要实体类和web</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--实体类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springcloud-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--热部署工具--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>application.yaml</code>的端口号</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置类<code>ConfigBean</code>，提供RestTemplate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Configuration 注解相当于Spring中的applicationContext.xml，然后在里面注册bean</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建控制类（消费者）<code>DeptConsumerController</code>，需要调用远程的业务层</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptConsumerController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 理解：消费者不应该有service业务层</span></span><br><span class="line">    <span class="comment">// RestTemplate 供我们直接调用业务层的url即可！它需要注册到Spring中</span></span><br><span class="line">    <span class="comment">// (String url, Class&lt;T&gt; responseType, Object... uriVariables)传递地址、返回类型...</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REST_URL_PREFIX = <span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/dept/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Dept dept)</span></span>&#123;</span><br><span class="line">        System.out.println(dept);</span><br><span class="line">        <span class="comment">// url地址，参数，返回类型</span></span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(REST_URL_PREFIX + <span class="string">&quot;/dept/add?dname=&quot;</span> + dept.getDname(), dept, Boolean.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/dept/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">get</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(REST_URL_PREFIX + <span class="string">&quot;/dept/get/&quot;</span> + id, Dept.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/dept/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(REST_URL_PREFIX + <span class="string">&quot;/dept/list&quot;</span>, List.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建主启动类<code>DeptConsumer_80</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptConsumer_80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptConsumer_80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试：<strong>先启动8001的项目</strong>，提供者</p>
<p><img src="/2020/08/02/SpringCloud/image-20200730165832903.png" alt="image-20200730165832903" loading="lazy"></p>
</li>
<li><p>运行成功之后，<strong>启动80的项目</strong>，消费者（启动失败，因为本地端口被启动了，所以<strong>在配置文件改为8002端口测试</strong>）</p>
</li>
<li><p>测试成功：在消费者项目中也成功访问到了，还可以访问到数据库</p>
<p><img src="/2020/08/02/SpringCloud/image-20200730170620516.png" alt="image-20200730170620516" loading="lazy"></p>
<p><img src="/2020/08/02/SpringCloud/image-20200730174727048.png" alt="image-20200730174727048" loading="lazy"></p>
<p>还可以使用<code>restTemplate.postForObject</code>进行post提交</p>
</li>
</ol>
<h2 id="5、Eureka服务注册与发现"><a href="#5、Eureka服务注册与发现" class="headerlink" title="5、Eureka服务注册与发现"></a>5、Eureka服务注册与发现</h2><h3 id="5-1、什么是Eureka（尤里卡）"><a href="#5-1、什么是Eureka（尤里卡）" class="headerlink" title="5.1、什么是Eureka（尤里卡）"></a>5.1、什么是Eureka（尤里卡）</h3><ul>
<li><p>Netflix在设计Eureka时，遵循的就是AP原则</p>
</li>
<li><p>Eureka是Netflix的一个子模块，也是核心模块之一。Eureka是一个基于REST的服务，用于定位服务，以实现云端中间层服务发现和故障转移，服务注册与发现对于微服务来说是非常重要的，有了服务发现与注册，只需要使用服务的标识符，就可以访问到服务，而不需要修改服务调用的配置文件了，功能类似于Dubbo的注册中心，比如Zookeeper</p>
</li>
</ul>
<h3 id="5-2、原理讲解"><a href="#5-2、原理讲解" class="headerlink" title="5.2、原理讲解"></a>5.2、原理讲解</h3><p>Eureka的基本架构</p>
<ul>
<li>SpringCloud封装了NetFlix公司开发的Eureka模块来实现服务注册和发现</li>
<li>Eureka采用了C-S的架构设计，EurekaServer作为服务注册功能的服务器，他是服务注册中心</li>
<li>而系统中的其他微服务，使用Eureka的客户端连接到EurekaServer并维护<strong>心跳连接</strong>（太久没联系就没了）。这样系统的维护人员就可以通过EurekaServer来监控系统中的各个微服务是否正常运行，SpringCloud的一些其他模块就可以通过EurekaServer来发现系统中的其他微服务，并执行相关的逻辑</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190703102014756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F3ZTg2MzE0,size_16,color_FFFFFF,t_70" alt="img" loading="lazy"></p>
<ul>
<li>Eureka包含两个组件：<strong>Eureka Server</strong>和<strong>Eureka Client</strong></li>
<li>Eureka Server：提供注册服务，各个节点启动后，会在EurekaServer中进行注册</li>
<li>Eureka Client：是一个java客户端，用于简化交互，将会向Eureka Server发送心跳（默认周期为30秒）。如果多个心跳周期内没有接收到某个节点的心跳，Eureka Server将会从服务注册表中将这个服务节点移除掉（默认周期为90秒）</li>
</ul>
<blockquote>
<p>三大角色</p>
</blockquote>
<ol>
<li>Eureka Server：提供服务的注册与发现</li>
<li>Service Provider：将自身服务注册到Eureka中，从而使消费方能够找到</li>
<li>Service Consumer：服务消费方从Eureka中获取注册服务列表，从而找到消费服务</li>
</ol>
<h3 id="5-3、创建一个注册中心"><a href="#5-3、创建一个注册中心" class="headerlink" title="5.3、创建一个注册中心"></a>5.3、创建一个注册中心</h3><ol>
<li><p>新建一个模块<code>springcloud-eureka-7001</code></p>
</li>
<li><p>导入依赖<code>spring-cloud-starter-eureka-server</code>1.4.6</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-eureka-server --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 热部署工具 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置端口号</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span>  <span class="comment"># Eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># 表示是否向Eureka注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># 为false表示自己为注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># 监控页面</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写主启动类，<code>EurekaServer_7001</code>开启功能  @EnableXXX</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServer_7001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaServer_7001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动测试，可以访问到Eureka的默认页面</p>
<p><img src="/2020/08/02/SpringCloud/image-20200730221150033.png" alt="image-20200730221150033" loading="lazy"></p>
</li>
</ol>
<h3 id="5-4、进行注册"><a href="#5-4、进行注册" class="headerlink" title="5.4、进行注册"></a>5.4、进行注册</h3><ol>
<li><p>在<code>8001</code>项目中增加<code>Eureka</code>的maven依赖，导入<code>spring-cloud-startter-eureka</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-eureka --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>application.yml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># Eureka的配置，注册到哪里</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://localhost:7001/eureka/</span><br></pre></td></tr></table></figure>
</li>
<li><p>在主启动类，开启注解支持<code>@EnableEurekaClient</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span>    <span class="comment">// 在服务启动后自动注册到Eureka中</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptProvider_8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptProvider_8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试：先启动7001项目，然后开启8001</p>
</li>
<li><p>访问页面：</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731102547529.png" alt="image-20200731102547529" loading="lazy"></p>
</li>
<li><p>修改项目描述</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">springcloud-provider-dept8001</span></span><br></pre></td></tr></table></figure>

<p>修改之后使用构建进行热部署，可能会出来下图警告，再次点击重建即可。</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731102848470.png" alt="image-20200731102848470" loading="lazy"></p>
<p><img src="/2020/08/02/SpringCloud/image-20200731103046705.png" alt="image-20200731103046705" loading="lazy"></p>
<p>部署完之后会发现描述已经修改</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731103125811.png" alt="image-20200731103125811" loading="lazy"></p>
</li>
</ol>
<blockquote>
<p>修改点击描述之后的页面内容</p>
</blockquote>
<ol>
<li><p>继续在<code>8001</code>项目中导入依赖<code>spring-boot-starter-actuator</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--actuator完善监控信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># info配置</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">app.name:</span> <span class="string">xj-springcloud</span></span><br><span class="line">  <span class="attr">company.name:</span> <span class="string">lxjblog.gitee.io</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重新启动8001进行测试</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731104331435.png" alt="image-20200731104331435" loading="lazy"></p>
<p>会跳转显示我们刚才配置的信息</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731104308003.png" alt="image-20200731104308003" loading="lazy"></p>
</li>
</ol>
<blockquote>
<p>然后就是上面那个爆红的问题</p>
</blockquote>
<ul>
<li>这是Eureka的<strong>自我保护机制</strong></li>
<li>某时刻某一微服务不可以使用了（就像刚才将8001项目停止），eureka不会立即清理，依旧会对该服务的信息进行保存，即仍然可以看到8001项目的信息，但是点进去描述网站会报错。【当一个服务崩了就会触发】</li>
<li>这是微服务的心跳连接，当超过90秒的时候就会出现上面爆红的情况，当接收的心跳数恢复到阈值以上时，该节点就会自动退出自我保护机制，然后红字会保留一段时间才恢复</li>
<li><strong>Eureka架构宁可同时保留所有的微服务，也不盲目注销任何健康的微服务</strong></li>
<li>在springcloud中，可以使用<code>eureka.server.enable-self-preservation = false</code>禁用自我保护机制【不推荐关闭】</li>
</ul>
<blockquote>
<p>对注册进来的微服务，获取信息</p>
</blockquote>
<ol>
<li><p>编写控制类，注意不要导错包，是<code>springframework</code>下的，不然显示无法自动装配</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取一些配置的信息，得到具体的微服务</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient client;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/dept/discovery&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">discovery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 获取微服务列表的清单</span></span><br><span class="line">    List&lt;String&gt; services = client.getServices();</span><br><span class="line">    System.out.println(<span class="string">&quot;discovery==&gt;services&quot;</span> + services);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 得到一个具体的微服务信息，通过id（微服务名称）获取</span></span><br><span class="line">    List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="string">&quot;SPRINGCLOUD-PROVIDER-DEPT&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (ServiceInstance instance : instances)&#123;</span><br><span class="line">        System.out.println(</span><br><span class="line">            instance.getHost() + <span class="string">&quot;\t&quot;</span> +</span><br><span class="line">            instance.getPort() + <span class="string">&quot;\t&quot;</span> +</span><br><span class="line">            instance.getUri() + <span class="string">&quot;\t&quot;</span> +</span><br><span class="line">            instance.getInstanceId() + <span class="string">&quot;\t&quot;</span> +</span><br><span class="line">            instance.getServiceId() + <span class="string">&quot;\t&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.client;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在主启动类中增加注解<code>@EnableDiscoveryClient</code></p>
</li>
<li><p>热部署项目测试，只构建8001项目即可，不需要重启7001</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731111733911.png" alt="image-20200731111733911" loading="lazy"></p>
</li>
<li><p>测试：访问<a target="_blank" rel="noopener" href="http://localhost:8001/dept/discovery">http://localhost:8001/dept/discovery</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200731111908854.png" alt="image-20200731111908854" loading="lazy"></p>
<p>同时控制台输出对应的信息</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731112030892.png" alt="image-20200731112030892" loading="lazy"></p>
</li>
</ol>
<p>小结：</p>
<ul>
<li>导入Eureka依赖<code>spring-cloud-starter-eureka</code></li>
<li>编写配置信息，即要注册到哪</li>
<li>开启注解支持<code>@EnableEurekaClient</code>，这样就可以把我们的服务注册到Eureka中</li>
<li>而通过导入<code>spring-boot-starter-actuator</code>可以配置描述的信息</li>
</ul>
<h3 id="5-5、Eureka集群配置"><a href="#5-5、Eureka集群配置" class="headerlink" title="5.5、Eureka集群配置"></a>5.5、Eureka集群配置</h3><ol>
<li><p>创建两个新模块<code>springcloud-eureka-7002</code>、<code>springcloud-eureka-7003</code></p>
</li>
<li><p>导入<code>7001</code>中的依赖，并分别复制配置文件，注意修改端口号</p>
</li>
<li><p>配置主启动类</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731113941440.png" alt="image-20200731113941440" loading="lazy"></p>
</li>
<li><p>修改本地的端口号映射</p>
<p>打开如下目录：C:\Windows\System32\drivers\etc</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731121057217.png" alt="image-20200731121057217" loading="lazy"></p>
<p>增加映射</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731121354205.png" alt="image-20200731121354205" loading="lazy"></p>
<p>如果无法修改，只要右击hosts ==&gt; 属性 ==&gt; 去掉“只读”属性即可</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731125532701.png" alt="image-20200731125532701" loading="lazy"></p>
<p>此时会弹出提示，点击允许操作即可</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731124133143.png" alt="image-20200731124133143" loading="lazy"></p>
</li>
<li><p>分别修改配置文件，现在不再是关联自己，而是分别关联其他两个注册中心</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731120033021.png" alt="image-20200731120033021" loading="lazy"></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置端口号</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>  <span class="comment"># Eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># 表示是否向Eureka注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># 为false表示自己为注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># 监控页面</span></span><br><span class="line">      <span class="comment"># 单机：defaultZone: http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br><span class="line">      <span class="comment"># 集群（关联其他的注册中心）</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br></pre></td></tr></table></figure>

<p>其他两个配置文件以此类推，分别进行关联</p>
</li>
<li><p>修改<code>8001</code>的配置文件，注册到上面的3个注册中心中</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/,http://localhost:7002/eureka/,http://localhost:7003/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">springcloud-provider-dept8001</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>分别启动3个注册中心</strong>，发现每个注册中心都关联起其他两个（点击可进行跳转）</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731124719543.png" alt="image-20200731124719543" loading="lazy"></p>
<p>也可以通过我们自定义的映射访问（因为太久没操作，开启了自我保护机制）</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731125142475.png" alt="image-20200731125142475" loading="lazy"></p>
</li>
<li><p>启动<code>8001</code>项目进行注册，发现该服务成功注册到每个注册中心</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731124942479.png" alt="image-20200731124942479" loading="lazy"></p>
</li>
</ol>
<p>【注意：该过程会比较占用电脑运行内存】</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731125351923.png" alt="image-20200731125351923" loading="lazy"></p>
<h3 id="5-6、Eureka与Zookeeper的对比"><a href="#5-6、Eureka与Zookeeper的对比" class="headerlink" title="5.6、Eureka与Zookeeper的对比"></a>5.6、Eureka与Zookeeper的对比</h3><blockquote>
<h4 id="CAP原则"><a href="#CAP原则" class="headerlink" title="CAP原则"></a>CAP原则</h4></blockquote>
<p><img src="/2020/08/02/SpringCloud/image-20200731130600612.png" alt="image-20200731130600612" loading="lazy"></p>
<p>一致性（C）：在<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/4905336">分布式系统</a>中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）</p>
<p>可用性（A）：在集群中一部分节点故障后，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%9B%86%E7%BE%A4/5486962">集群</a>整体是否还能响应<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AE%A2%E6%88%B7%E7%AB%AF/101081">客户端</a>的读写请求。（对数据更新具备高可用性）</p>
<p>分区容错性（P）：以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。</p>
<p>CAP原则的精髓就是要么AP，要么CP，要么AC，但是不存在CAP。</p>
<blockquote>
<h4 id="Eureka与Zookeeper对比"><a href="#Eureka与Zookeeper对比" class="headerlink" title="Eureka与Zookeeper对比"></a>Eureka与Zookeeper对比</h4></blockquote>
<p>著名的CAP理论指出：一个分布式系统不可能同时满足C（一致性）、A（可用性）、p（容错性）。由于分区容错性P在分布式系统中是必须要保证的，因此我们只能在A和C之间进行权衡。</p>
<ul>
<li>Zookeeper保证的是CP；</li>
<li>Eureka保证的是AP；</li>
</ul>
<p>​    当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接收服务直接down掉不可用。也就是说，服务注册功能对可用性的要求高于一致性。</p>
<p><strong>Zookeeper保证的是CP：</strong></p>
<p>​    当master主节点因为网络故障与其他节点失去联系的时候，剩余节点将会重新进行leader选举。而问题就在于，重新选择一个master主节点的时间太长，30~120s，且选举期间整个zookeeper集群都是不可用的，这就会导致选举期间注册服务瘫痪。</p>
<p><strong>Eureka保证的是AP:</strong></p>
<p>​    Eureka基于可用性的一点，所以<strong>各个节点都是平等的</strong>，几个节点挂掉不会影响正常节点的工作，剩余的节点依旧可以提供注册和查询服务，如果发现连接失败，会自动切换至其他节点。</p>
<p>​    只要有一台Eureka还在，就能保证注册服务的可用性，只不过查到的信息可能不是最新的。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现的网络故障，会出现以下几种情况：</p>
<ol>
<li>Eureka不再从注册列表中移除因为长时间没有收到心跳而应该过期的服务</li>
<li>Eureka依然能够接受新服务的注册和查询请求，但是不会被同步到其他节点（即保证当前节点仍然可用）</li>
<li>当网络稳定时，当前实例新的注册信息会被同步到其他节点中</li>
</ol>
<blockquote>
<p>因此Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。</p>
</blockquote>
<h2 id="6、Ribbon负载均衡"><a href="#6、Ribbon负载均衡" class="headerlink" title="6、Ribbon负载均衡"></a>6、Ribbon负载均衡</h2><p>中文文档：<a target="_blank" rel="noopener" href="https://www.springcloud.cc/spring-cloud-netflix.html">https://www.springcloud.cc/spring-cloud-netflix.html</a></p>
<h3 id="6-1、Ribbon是什么"><a href="#6-1、Ribbon是什么" class="headerlink" title="6.1、Ribbon是什么"></a>6.1、Ribbon是什么</h3><ul>
<li><p>Spring Cloud Ribbon是基于Netflix Ribbon实现的一套<strong>客户负载均衡的工具</strong></p>
</li>
<li><p>简单来说，Ribbon是Netflix发布的开源项目，主要功能是提供客户端的软件负载均衡算法，将Netflix的中间层服务连接在一起。Ribbon的客户端组件提供一系列完整的配置项如:连接超时、重试等等。简单的说,就是在配置文件中列岀 Load Balancer(简称LB:负载均衡)后面所有的机器, Ribbon会自动的帮助你基于某种规则(如简单轮询,随机连接等等)去连接这些机器。</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731134003657.png" alt="image-20200731134003657" loading="lazy"></p>
</li>
</ul>
<p><strong>ribbon能干嘛？</strong></p>
<ul>
<li><p>LB，即负载均衡( Load Balance),在微服务或分布式集群中经常用的一种应用</p>
</li>
<li><p><strong>负载均衡简单的说就是将用户的请求平摊的分配到多个服务上,从而达到系统的HA(高可用)。</strong></p>
</li>
<li><p>常见的负载均衡软件有 Nginx,Lvs等等</p>
</li>
<li><p>dubbo、 Spring Cloud中均给我们提供了负载均衡, Spring Cloud的负载均衡算法可以自定义</p>
</li>
<li><p>负载均衡简单分类</p>
<p><strong>集中式LB</strong>：即在服务的消费方和提供方之间使用独立的LB设施,如Ngin,由该设施负责把访问请求通过某种策略转发至服务的提供方。</p>
<p><strong>进程式LB：</strong>将LB逻辑集成到消费方,消费方从服务注册中心获知有哪些地址可用,然后自己再从这些地址中选出一个合适的服务器。Ribbon就属于进程内LB,它只是一个类库,集成于消费方进程,消费方通过它来获取到服务提供方</p>
</li>
</ul>
<h3 id="6-2、Ribbon集成测试"><a href="#6-2、Ribbon集成测试" class="headerlink" title="6.2、Ribbon集成测试"></a>6.2、Ribbon集成测试</h3><ol>
<li><p>在<code>消费者</code>项目中，导入Ribbon依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-netflix-ribbon --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入eureka依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-eureka --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Eureka的配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># 不向Eureka中注册自己</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动类中增加注解@EnableEurekaClient</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptConsumer_80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptConsumer_80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置类，配置负载均衡实现类RestTemplate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Configuration 注解相当于Spring中的applicationContext.xml，然后在里面注册bean</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改控制类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这里我们访问的地址应该是一个变量，通过服务名来访问</span></span><br><span class="line"><span class="comment">// private static final String REST_URL_PREFIX = &quot;http://localhost:8001&quot;;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REST_URL_PREFIX = <span class="string">&quot;http://SPRINGCLOUD-PROVIDER-DEPT&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/02/SpringCloud/image-20200731142103249.png" alt="image-20200731142103249" loading="lazy"></p>
</li>
<li><p>启动测试，开启注册中心 ==&gt; 开启提供者 ==&gt; 开启消费者</p>
</li>
<li><p>访问：<a target="_blank" rel="noopener" href="http://localhost/consumer/dept/list">http://localhost/consumer/dept/list</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200731142555064.png" alt="image-20200731142555064" loading="lazy"></p>
<p>消费者可以查询出相应的数据就OK了</p>
</li>
</ol>
<h3 id="6-3、负载均衡的实现"><a href="#6-3、负载均衡的实现" class="headerlink" title="6.3、负载均衡的实现"></a>6.3、负载均衡的实现</h3><blockquote>
<p>创建多个相同服务提供者，消费者访问的时候会轮询从3个提供者中查询</p>
</blockquote>
<p><img src="/2020/08/02/SpringCloud/image-20200731143357873.png" alt="image-20200731143357873" loading="lazy"></p>
<ol>
<li><p>创建新的数据库，将<code>db01</code>数据库进行右击导出备份</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731143548473.png" alt="image-20200731143548473" loading="lazy"></p>
<p><img src="/2020/08/02/SpringCloud/image-20200731143832503.png" alt="image-20200731143832503" loading="lazy"></p>
</li>
<li><p>使用指令创建新的数据库，创建<code>db02</code>和<code>db03</code>项目</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> db02;</span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> db02;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for dept</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`dept`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`dept`</span>  (</span><br><span class="line">    <span class="string">`deptno`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`dname`</span> <span class="built_in">varchar</span>(<span class="number">60</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`db_source`</span> <span class="built_in">varchar</span>(<span class="number">60</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`deptno`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">1</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_general_ci <span class="keyword">COMMENT</span> = <span class="string">&#x27;部门表&#x27;</span> ROW_FORMAT = Dynamic;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span>(dname,db_source) <span class="keyword">VALUES</span> (<span class="string">&#x27;开发部&#x27;</span>,<span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span>(dname,db_source) <span class="keyword">VALUES</span> (<span class="string">&#x27;人事部&#x27;</span>,<span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span>(dname,db_source) <span class="keyword">VALUES</span> (<span class="string">&#x27;财务部&#x27;</span>,<span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span>(dname,db_source) <span class="keyword">VALUES</span> (<span class="string">&#x27;市场部&#x27;</span>,<span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span>(dname,db_source) <span class="keyword">VALUES</span> (<span class="string">&#x27;运营部&#x27;</span>,<span class="keyword">DATABASE</span>());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`dept`</span>(dname,db_source) <span class="keyword">VALUES</span> (<span class="string">&#x27;娱乐部&#x27;</span>,<span class="keyword">DATABASE</span>());</span><br></pre></td></tr></table></figure>
</li>
<li><p>在IDEA中导入三个数据库</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731145316004.png" alt="image-20200731145316004" loading="lazy"></p>
</li>
<li><p>创建新的提供者，<code>8002</code>、<code>8003</code></p>
</li>
<li><p>拷贝依赖和配置文件</p>
</li>
<li><p><strong>修改配置文件中的端口和数据库名字、描述名称</strong></p>
</li>
<li><p>拷贝mybatis配置文件</p>
</li>
<li><p>拷贝其余的所有文件</p>
</li>
<li><p><strong>只需要修改各自的主启动类即可</strong></p>
<p><strong>所以上面三个提供者只有数据库不同而已</strong></p>
</li>
<li><p>依次启动服务（只需要一个注册中心就行），其中会看到提供者会出现报错，这是因为没有启动所有注册中心，但这并不影响</p>
</li>
<li><p>启动成功之后访问：<a target="_blank" rel="noopener" href="http://localhost/consumer/dept/get/1">http://localhost/consumer/dept/get/1</a></p>
<p>第一次我们访问到的是db02数据库</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731151422655.png" alt="image-20200731151422655" loading="lazy"></p>
<p>刷新网页，我们访问到是db03数据库</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731151508656.png" alt="image-20200731151508656" loading="lazy"></p>
<p>在刷新就是访问到db01数据库</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731151546458.png" alt="image-20200731151546458" loading="lazy"></p>
</li>
</ol>
<p><strong>这就是Ribbon的轮询负载均衡机制</strong></p>
<h3 id="6-4、自定义负载均衡算法"><a href="#6-4、自定义负载均衡算法" class="headerlink" title="6.4、自定义负载均衡算法"></a>6.4、自定义负载均衡算法</h3><ol>
<li><p>算法查询，进入IRule查看实现的方法</p>
<ul>
<li>IRule</li>
<li>RoundRobonRule：轮询</li>
<li>RandomRule：随机</li>
<li>AvailabilityFilteringRule：会先过滤掉，跳闸，访问故障的服务，对剩下的进行轮询</li>
<li>RetryRule：会先按照轮询获得服务，如果服务获取失败，则会在指定的时间内进行重试</li>
</ul>
<p><img src="/2020/08/02/SpringCloud/image-20200731164333644.png" alt="image-20200731164333644" loading="lazy"></p>
</li>
<li><p>自定义Ribbon，通过在主启动类中添加注解配置</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731163146688.png" alt="image-20200731163146688" loading="lazy"></p>
</li>
<li><p><strong>注意：需要采取措施避免包含（例如将其放在一个单独的，不重叠的包中，或者指定要在<code>@ComponentScan</code>）</strong></p>
<p>所以我们需要在<code>springcloud</code>同级目录下创建我们自己的查询算法！</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731165125164.png" alt="image-20200731165125164" loading="lazy"></p>
</li>
<li><p>创建控制类，修改查询算法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">iRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 先使用默认的随机查询进行测试</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改完之后要在主启动类中进行注解配置</p>
<p><code>name</code>为我们应用程序的名称，<code>configuration</code>是我们自定义的查询控制类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;SPRINGCLOUD-PROVIDER-DEPT&quot;, configuration = MyRule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptConsumer_80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptConsumer_80.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动项目进行测试，此时我们的查询算法为随机的</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731165951172.png" alt="image-20200731165951172" loading="lazy"></p>
</li>
<li><p>拷贝随机查询的算法代码，创建我们自己的算法：每个服务获取3次数据，然后切换到下一个服务</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xj.myrule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.client.config.IClientConfig;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.AbstractLoadBalancerRule;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.ILoadBalancer;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.Server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadLocalRandom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRandomRule</span> <span class="keyword">extends</span> <span class="title">AbstractLoadBalancerRule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们自定义：每个服务获取3次数据，然后切换到下一个服务</span></span><br><span class="line">    <span class="comment">// total为访问的次数，currentIndex为哪一个服务</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> currentIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@edu.umd.cs.findbugs.annotations.SuppressWarnings(value = &quot;RCN_REDUNDANT_NULLCHECK_OF_NULL_VALUE&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Server <span class="title">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (lb == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Server server = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (server == <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">                <span class="comment">// 服务中断</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;Server&gt; upList = lb.getReachableServers(); <span class="comment">// 获取活着的服务列表</span></span><br><span class="line">            List&lt;Server&gt; allList = lb.getAllServers();  <span class="comment">// 获取所有的服务列表</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> serverCount = allList.size();</span><br><span class="line">            <span class="keyword">if</span> (serverCount == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 没有服务就退出</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 默认的随机算法</span></span><br><span class="line">            <span class="comment">// int index = chooseRandomInt(serverCount);   // 获得随机的字数</span></span><br><span class="line">            <span class="comment">// server = upList.get(index); // 从活着的服务中随机获取一个服务</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 自定义算法</span></span><br><span class="line">            <span class="comment">// =========================================================</span></span><br><span class="line">            <span class="keyword">if</span>(total &lt; <span class="number">2</span>)&#123;  <span class="comment">// 这里2次加上下方的1次，就为3次切换服务</span></span><br><span class="line">                server = upList.get(currentIndex);</span><br><span class="line">                total++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                total = <span class="number">0</span>;</span><br><span class="line">                currentIndex++;</span><br><span class="line">                <span class="keyword">if</span>(currentIndex &gt;= upList.size())&#123;</span><br><span class="line">                    currentIndex = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                server = upList.get(currentIndex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// =========================================================</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Thread.yield();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server.isAlive()) &#123;</span><br><span class="line">                <span class="keyword">return</span> (server);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            server = <span class="keyword">null</span>;</span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">chooseRandomInt</span><span class="params">(<span class="keyword">int</span> serverCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ThreadLocalRandom.current().nextInt(serverCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Server <span class="title">choose</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> choose(getLoadBalancer(), key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initWithNiwsConfig</span><span class="params">(IClientConfig clientConfig)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建好算法之后，我们需要在控制类中调用我们的算法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">iRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyRandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启<code>消费者</code>项目进行测试，发现只要刷新3次就会改变服务</p>
</li>
</ol>
<h2 id="7、Feign接口编程"><a href="#7、Feign接口编程" class="headerlink" title="7、Feign接口编程"></a>7、Feign接口编程</h2><h3 id="7-1、简介"><a href="#7-1、简介" class="headerlink" title="7.1、简介"></a>7.1、简介</h3><p><code>feign[feɪn]</code>是声明式的web service客户端，它让微服务之间调用变得更简单了，类似controller调用service。SpringCloud集成了Ribbon和Eureka，可以使用Frign时提供负载均衡的http客户端。</p>
<p>只需要创建一个接口，然后添加注解即可！符合面向接口编程。</p>
<blockquote>
<p>调用微服务访问两种方法</p>
</blockquote>
<ol>
<li>微服务名字【ribbon】</li>
<li>接口和注解【feign】</li>
</ol>
<p><strong>Feign能干嘛</strong></p>
<ul>
<li>Feign旨在编写Java Http客户端变得更容易</li>
<li>在使用上，我们只需要创建一个接口并使用注解的方式来配置它，<strong>类似于之前在<code>mapper</code>接口上编注<code>Mapper注解</code>，现在时一个微服务接口上面标注一个<code>Feign注解</code>即可。</strong></li>
</ul>
<p><strong>Feign集成了Ribbon</strong></p>
<ul>
<li>而不同的是，通过Feign只需要定义服务绑定接口且以声明式的方法，优雅而简单的实现了服务的调用</li>
</ul>
<h3 id="7-2、Feign使用步骤"><a href="#7-2、Feign使用步骤" class="headerlink" title="7.2、Feign使用步骤"></a>7.2、Feign使用步骤</h3><ol>
<li><p>创建新模块<code>springcloud-consumer-dept-feign</code>（也是作为消费者）</p>
</li>
<li><p>拷贝<code>80</code>项目的内容到当前项目</p>
</li>
<li><p>再导入feign的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-feign --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<code>springcloud-api</code>项目中也导入feign的依赖</p>
</li>
<li><p>创建<code>service</code>目录，编写业务类<code>DeptService</code>，让所有的服务可以使用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;SPRINGCLOUD-PROVIDER-DEPT&quot;)</span>   <span class="comment">// 关联到我们的服务类</span></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// 交给Spring托管</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeptService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/dept/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Dept dept)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">get</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>springcloud-consumer-dept-feign</code>项目的控制类代码，使得更加类似于我们的一般写法，调用接口实现数据库操作。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptConsumerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得业务类接口</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/dept/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(Dept dept)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.addDept(dept);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/dept/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">get</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getDept(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/dept/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.queryAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在主启动类中启动Feign</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &#123;&quot;com.xj.springcloud&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptConsumer_feign</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptConsumer_feign.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试：访问成功</p>
<p><img src="/2020/08/02/SpringCloud/image-20200731183351047.png" alt="image-20200731183351047" loading="lazy"></p>
</li>
</ol>
<p><strong>小结：</strong></p>
<ul>
<li>我们需要在<code>api</code>和<code>消费者</code>项目中增加Feign依赖</li>
<li>在<code>api</code>项目中创建业务类接口，<strong>关联服务名</strong>，并交给Spring托管（即添加两个注解）而接口代码与<code>提供者</code>中的控制类代码相同，但不需要实现体（即在方法上添加XXXMapper注解）。</li>
<li>然后在<code>消费者</code>项目中自动装配业务类接口，并调用方法，最后在主启动类中启动Feign注解<code>@EnableFeignClients(basePackages = &#123;&quot;com.xj.springcloud&quot;&#125;)</code></li>
</ul>
<blockquote>
<p>总之，Feign使我们的代码可以使用业务类进行数据操作，属于面向接口的编程，同时Feign使我们在原有的代码基础上多加了一层（业务层），使得代码的可读性提高了，但也降低了我们服务的性能（毕竟代码量增多了）</p>
</blockquote>
<h2 id="8、Hystrix保护机制"><a href="#8、Hystrix保护机制" class="headerlink" title="8、Hystrix保护机制"></a>8、Hystrix保护机制</h2><p><code>Hystrix [hɪst&#39;rɪks]</code>，中文含义是<strong>豪猪</strong>，因其背上长满棘刺，从而拥有了自我保护的能力。本文所说的Hystrix是Netflix开源的一款容错框架，同样具有自我保护能力。为了实现容错和自我保护。</p>
<blockquote>
<p>分布系统面临的问题</p>
</blockquote>
<p>​    复杂分布式体系结构中的应用程序有数十个依赖关系，每个依赖关系在某些时候将不可避免的失败！</p>
<blockquote>
<p>服务雪崩</p>
</blockquote>
<p>​    多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，微服务B和微服务C又调用其他的微服务，这就是所谓的“扇出”、如果扇出的链路上某个微服务的调用响应时间过长或者不可用，对微服务A的调用就会占用越来越多的系统资源，进而引起系统崩溃，所谓的“雪崩效应”。</p>
<p>​    对于高流量的应用来说，单一的后端依赖可能会导致所有服务器上的所有资源在几秒钟内饱和，比失败更糟糕的是，这些应用程序还可能导致服务之间的延迟增加，备份队列，线程和其他系统资源紧张，导致整个系统发生更多的级联故障，这些都表示需要对故障和延迟进行隔离和管理，以便单个依赖关系的失败，不能取消整个应用程序或系统。</p>
<h3 id="8-1、什么是Hystrix-豪猪"><a href="#8-1、什么是Hystrix-豪猪" class="headerlink" title="8.1、什么是Hystrix(豪猪)"></a>8.1、什么是Hystrix(豪猪)</h3><p>​    Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多以来不可避免的会调用失败，比如超时，异常等。Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801105816572.png" alt="image-20200801105816572" loading="lazy"></p>
<p>​    “断路器”本身就是一个开关装置，当某一个服务单元发生故障之后，通过断路器的故障监控（类似熔断保险丝）。向调用方返回一个服务预期的，可处理的备选响应（FallBack），而不是长时间的等待或抛出调用方法无法处理的异常，这样就可以保证服务调用方的线程不会被长时间，不必要的占用，从而避免了故障在分布式系统中的蔓延，乃至雪崩。</p>
<blockquote>
<p>能干嘛</p>
</blockquote>
<ul>
<li><p>服务降级</p>
</li>
<li><p>服务熔断</p>
</li>
<li><p>服务限流</p>
</li>
<li><p>接近实时的监控</p>
</li>
<li><p>……</p>
</li>
</ul>
<p><strong>官网资料：</strong><a target="_blank" rel="noopener" href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a></p>
<h3 id="8-2、服务熔断"><a href="#8-2、服务熔断" class="headerlink" title="8.2、服务熔断"></a>8.2、服务熔断</h3><p>熔断机制是对应雪崩效应的一种微服务链路保护机制</p>
<p>当扇出链路的某个微服务不可用或者响应时间太长时，会进行服务的降级，进而熔断该节点的微服务调用，快速返回错误的响应信息。当检测到该节点微服务调用响应正常后恢复调用链路。在SpringCloud框架里的熔断机制通过Hystrix实现。Hystrix会监控微服务间调用的状况，当失败的调用到一定阈值，缺省5秒内20次调用失败就会启动熔断机制。熔断机制的注解是<code>@HystrixCommand</code>。</p>
<blockquote>
<p>测试</p>
</blockquote>
<ol>
<li><p>创建新模块<code>springcloud-provider-dept-hystrix-8001</code></p>
</li>
<li><p>拷贝<code>8001</code>项目到新项目中</p>
</li>
<li><p>修改主启动类名称</p>
</li>
<li><p>导入<code>Hystrix</code>依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-hystrix --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件，修改Eureka上的描述</p>
</li>
<li><p>编写控制类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;hystrixGet&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">getDept</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        Dept dept = deptService.queryById(id);</span><br><span class="line">        <span class="keyword">if</span> (dept == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dept;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">hystrixGet</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Dept()</span><br><span class="line">                .setDeptno(id)</span><br><span class="line">                .setDname(<span class="string">&quot;id ==&gt;&quot;</span> + id + <span class="string">&quot;没有对应的信息，null——Hystrix&quot;</span> )</span><br><span class="line">                .setDb_source(<span class="string">&quot;no this database in MySQL&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启断路器的支持</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span>   <span class="comment">// 开启熔断机制</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptProviderHystrix_8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptProviderHystrix_8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动测试，开启<code>注册中心</code>=》开启刚创建的<code>提供者</code>=》开启<code>消费者</code>（改为了81端口）=》进行错误查询测试</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801114921776.png" alt="image-20200801114921776" loading="lazy"></p>
</li>
<li><p>修改配置类（浏览器左下角显示真实的ip）</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">springcloud-provider-dept-hystrix-8001</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span> <span class="comment"># 显示真实的IP地址</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/02/SpringCloud/image-20200801114833325.png" alt="image-20200801114833325" loading="lazy"></p>
</li>
</ol>
<h3 id="8-3、服务降级"><a href="#8-3、服务降级" class="headerlink" title="8.3、服务降级"></a>8.3、服务降级</h3><blockquote>
<p>服务降级是在客户端做的操作</p>
</blockquote>
<p>为了让A微服务不会崩溃，停用了闲置的服务器，把C的服务终止~所以我们在服务被关闭的时候需要进行相应的提示</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801120913812.png" alt="image-20200801120913812" loading="lazy"></p>
<p><strong>测试:</strong></p>
<ol>
<li><p>在<code>api</code>项目中创建一个业务类<code>DeptServiceFallback</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptServiceFallback</span> <span class="keyword">implements</span> <span class="title">FallbackFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DeptService <span class="title">create</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 返回一个实现了的接口</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DeptService() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Dept <span class="title">getDept</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Dept()</span><br><span class="line">                        .setDeptno(id)</span><br><span class="line">                        .setDname(<span class="string">&quot;id=&gt;&quot;</span> + id + <span class="string">&quot;没有对应的信息，客户端提供了降级的信息，这个服务现在已经被关闭&quot;</span>)</span><br><span class="line">                        .setDb_source(<span class="string">&quot;没有数据&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 以下方法也可以进行相应的处理</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addDept</span><span class="params">(Dept dept)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">queryAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在业务类中关联到我们的降级业务，使用<code>fallbackFactory</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;SPRINGCLOUD-PROVIDER-DEPT&quot;, fallbackFactory = DeptServiceFallback.class)</span>   <span class="comment">// 关联到我们的服务类</span></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">// 交给Spring托管</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DeptService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/dept/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addDept</span><span class="params">(Dept dept)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dept <span class="title">getDept</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/dept/list&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Dept&gt; <span class="title">queryAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>因为使用的是Feign的支持，所以需要修改<code>springcloud-consumer-dept-feign</code>的配置文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Feign配置</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动测试：<code>注册中心</code> =》 <code>提供者</code> =》 <code>feign消费者</code></p>
<p>正常访问</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801130145311.png" alt="image-20200801130145311" loading="lazy"></p>
<p>把<code>提供者</code>关闭测试，显示出我们的降级信息</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801130227685.png" alt="image-20200801130227685" loading="lazy"></p>
</li>
</ol>
<p><strong>小结</strong>:</p>
<ul>
<li><p>在API项目中，创建<code>处理异常的业务类</code>，实现<code>FallbackFactory</code>接口，返回主要业务的接口并实现</p>
</li>
<li><p>在主业务中通过在<code>@FeignClient</code>注解中添加<code>fallbackFactory</code>属性，关联到异常业务</p>
</li>
<li><p>在<code>消费者</code>项目的配置文件中进行配置，开启<code>feign.hystrix.enabled = true</code></p>
</li>
</ul>
<h3 id="8-4、Dashboard流监控"><a href="#8-4、Dashboard流监控" class="headerlink" title="8.4、Dashboard流监控"></a>8.4、Dashboard流监控</h3><ol>
<li><p>创建新模块<code>springcloud-consumer-hystrix-dashboard</code></p>
</li>
<li><p>导入<code>消费者</code>的依赖，然后再导入Hystrix依赖，以及Dashboard监控</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-hystrix --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-hystrix-dashboard --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>application.yml</code>，编写端口号<code>9001</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建主启动类，增加开启Dashboard注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HystrixDashboard9001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(HystrixDashboard9001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：每个<code>提供者</code>项目都需要有监控的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--actuator完善监控信息--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动主启动类测试，进去hystrix页面，可以看到一只豪猪即可</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801133128840.png" alt="image-20200801133128840" loading="lazy"></p>
</li>
<li><p>修改<code>springcloud-provider-dept-hystrix-8001</code>项目，必须是有熔断机制的那个项目！！！【折腾了好久】</p>
<p>增加一个Bean进行注册</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span>   <span class="comment">// 开启熔断机制</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptProviderHystrix_8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DeptProviderHystrix_8001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加一个Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">hystrixMetricsStreamServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean registrationBean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> HystrixMetricsStreamServlet());</span><br><span class="line">        registrationBean.addUrlMappings(<span class="string">&quot;/actuator/hystrix.stream&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动<code>7001</code> =&gt; 监控页面<code>9001</code> =&gt; <code>8001</code>进行注册</p>
</li>
<li><p>先访问<a target="_blank" rel="noopener" href="http://localhost:8001/dept/get/1">http://localhost:8001/dept/get/1</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801152738823.png" alt="image-20200801152738823" loading="lazy"></p>
<p>然后访问<a target="_blank" rel="noopener" href="http://localhost:8001/actuator/hystrix.stream">http://localhost:8001/actuator/hystrix.stream</a></p>
<p>可以看到监控出来的一推数据</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801152820894.png" alt="image-20200801152820894" loading="lazy"></p>
</li>
<li><p>访问：<a target="_blank" rel="noopener" href="http://localhost:9001/hystrix%E9%A1%B5%E9%9D%A2%EF%BC%8C%E8%BE%93%E5%85%A5%E8%A6%81%E7%9B%91%E6%8E%A7%E7%9A%84%E9%A1%B5%E9%9D%A2http://localhost:8001/actuator/hystrix.stream">http://localhost:9001/hystrix页面，输入要监控的页面http://localhost:8001/actuator/hystrix.stream</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801153011869.png" alt="image-20200801153011869" loading="lazy"></p>
<p>不断刷新我们的访问页面<a target="_blank" rel="noopener" href="http://localhost:8001/dept/get/1%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E9%87%8C%E9%9D%A2%E7%9A%84%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7">http://localhost:8001/dept/get/1，可以看到里面的实时监控</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801152549620.png" alt="image-20200801152549620" loading="lazy"></p>
</li>
</ol>
<blockquote>
<h4 id="内容含义"><a href="#内容含义" class="headerlink" title="内容含义"></a>内容含义</h4></blockquote>
<ul>
<li><h4 id="一圆"><a href="#一圆" class="headerlink" title="一圆"></a>一圆</h4><p>实心圆：总共有两种含义，它通过颜色的变化代表了实例的健康程度</p>
<p>它的健康程度从绿色&lt; 黄色 &lt; 橙色 &lt; 红色 递减</p>
<p>该实心圆除了颜色的变化之外，它的大小也会根据实例的请求流量发生变化，流量越大，该实心圆就越大，所以通过该实心圆的展示，就可以在大量的实例中快速发现<strong>故障实例和高压力实例</strong>。</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801153546084.png" alt="image-20200801153546084" loading="lazy"></p>
<p>比如：当我们一直访问错误的页面的时候，就会变为红色</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801154019115.png" alt="image-20200801154019115" loading="lazy"></p>
</li>
<li><h4 id="一线"><a href="#一线" class="headerlink" title="一线"></a>一线</h4><p>曲线用来记录2分钟内流量的相对变化，可以通过它来观察到流量的上升和下降趋势！</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801153701943.png" alt="image-20200801153701943" loading="lazy"></p>
</li>
<li><h4 id="整图说明"><a href="#整图说明" class="headerlink" title="整图说明"></a>整图说明</h4><p><img src="/2020/08/02/SpringCloud/image-20200801153836448.png" alt="image-20200801153836448" loading="lazy"></p>
</li>
</ul>
<h2 id="9、Zuul路由网关"><a href="#9、Zuul路由网关" class="headerlink" title="9、Zuul路由网关"></a>9、Zuul路由网关</h2><p><img src="/2020/08/02/SpringCloud/image-20200801170826742.png" alt="image-20200801170826742" loading="lazy"></p>
<h3 id="9-1、什么是Zuul"><a href="#9-1、什么是Zuul" class="headerlink" title="9.1、什么是Zuul"></a>9.1、什么是Zuul</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://github.com/Netflix/zuul/wiki">https://github.com/Netflix/zuul/wiki</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801154518122.png" alt="image-20200801154518122" loading="lazy"></p>
<p>Zuul包含了对请求的路由和过滤的两个最主要的功能：</p>
<p>其中路由功能负责将外部请求转发到具体的微服务实力上（即通过域名转发到我们真实的地址），是实现外部访问统一入口（即整合我们的所有端口）的基础，而过滤功能则负责对请求的处理过程进行干预，是实现请求校验，服务聚合等功能的基础。</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801155409190.png" alt="image-20200801155409190" loading="lazy"></p>
<p>Zuul和Eureka进行整合，将Zuul自身注册为Eureka服务治理下的应用，同时从Eureka中获得其他微服务的消息，即以后的访问微服务都是通过Zuul跳转后获得。</p>
<ul>
<li>注意：Zuul服务最终还是会注册进Eureka</li>
<li>提供：代理 + 路由 + 过滤 三大功能！</li>
</ul>
<h3 id="9-2、项目测试"><a href="#9-2、项目测试" class="headerlink" title="9.2、项目测试"></a>9.2、项目测试</h3><ol>
<li><p>新建模块<code>springcloud-zuul-6001</code></p>
</li>
<li><p>导入<code>springcloud-consumer-hystrix-dashboard</code>的所有依赖</p>
</li>
<li><p>导入zuul依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-zuul --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-zuul</span>    <span class="comment"># 应用程序名</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">zuul6001.com</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">app.name:</span> <span class="string">springcloud</span></span><br><span class="line">  <span class="attr">companny.name:</span> <span class="string">blog.springcloud.com</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建主启动类，开启zuul代理注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zuul_6001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Zuul_6001.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动<code>7001</code>，启动<code>8001</code>，启动<code>6001</code></p>
</li>
<li><p>进入<code>7001</code>，看到两个应用程序那就没问题</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801163000754.png" alt="image-20200801163000754" loading="lazy"></p>
</li>
<li><p>然后进入<a target="_blank" rel="noopener" href="http://localhost:8001/dept/get/1%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0%E6%95%B0%E6%8D%AE">http://localhost:8001/dept/get/1可以访问到数据</a></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801163043791.png" alt="image-20200801163043791" loading="lazy"></p>
<p>然后使用<code>6001</code>项目进行访问<a target="_blank" rel="noopener" href="http://localhost:6001/springcloud-provider-dept/dept/get/1%EF%BC%8C%E5%90%8C%E6%A0%B7%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0">http://localhost:6001/springcloud-provider-dept/dept/get/1，同样可以访问到</a></p>
<p>使用<code>http://localhost:6001</code> 加 <code>要访问的应用名（小写形式）</code> 加<code>查询的内容</code></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801163245212.png" alt="image-20200801163245212" loading="lazy"></p>
</li>
</ol>
<h3 id="9-3、路由网关的配置"><a href="#9-3、路由网关的配置" class="headerlink" title="9.3、路由网关的配置"></a>9.3、路由网关的配置</h3><blockquote>
<p>通过配置文件的配置，我们可以正式实现：</p>
<ol>
<li>统一的访问地址（路由） XXX.path</li>
<li>拦截（过滤）直接访问真实的地址ignored-services:</li>
</ol>
</blockquote>
   <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">mydept.serviceId:</span> <span class="string">springcloud-provider-dept</span> <span class="comment"># 绑定原来的服务名称</span></span><br><span class="line">    <span class="attr">mydepr.path:</span> <span class="string">mydept</span> <span class="comment"># 自定义服务名称</span></span><br><span class="line"><span class="comment"># ignored-services: springcloud-provider-dept # 不能再使用这个路径访问了</span></span><br><span class="line">  <span class="attr">ignored-services:</span> <span class="string">&quot;*&quot;</span>  <span class="comment"># 只能使用自定义服务名访问</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">/xj</span></span><br></pre></td></tr></table></figure>

<p>   路由的设置：<strong>自定义属性前缀，后缀从下图的属性中选择</strong></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801163834026.png" alt="image-20200801163834026" loading="lazy"></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801163814040.png" alt="image-20200801163814040" loading="lazy"></p>
<p>   其他更多的配置可以在源码中查看</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801164219768.png" alt="image-20200801164219768" loading="lazy"></p>
<blockquote>
<h4 id="开启测试"><a href="#开启测试" class="headerlink" title="开启测试"></a>开启测试</h4></blockquote>
<p><img src="/2020/08/02/SpringCloud/image-20200801164644932.png" alt="image-20200801164644932" loading="lazy"></p>
<p><strong>需要有前缀和自定义名称才可以访问</strong></p>
<p><img src="/2020/08/02/SpringCloud/image-20200801165957432.png" alt="image-20200801165957432" loading="lazy"></p>
<p><strong>现在我们可以使用<code>6001</code>端口访问原来<code>8001</code>、<code>8002</code>、<code>8003</code>的内容了</strong></p>
<h2 id="10、SpringCloud-Config配置"><a href="#10、SpringCloud-Config配置" class="headerlink" title="10、SpringCloud Config配置"></a>10、SpringCloud Config配置</h2><p>可以使用Github、Coding以及码云，但是码云是速度最快的。</p>
<h3 id="10-1、概述"><a href="#10-1、概述" class="headerlink" title="10.1、概述"></a>10.1、概述</h3><blockquote>
<p>分布式系统面临的配置文件的问题</p>
</blockquote>
<p>微服务意味着要将单个应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务，由于每个服务都需要必要的配置信息才能运行，所以一套集中式的，动态的配置管理设施是必不可少的。SpringCould提供了ConfigServer来解决这个问题，我们每一个微服务自己带着一个<code>application.yml</code>，那上百个的配置文件要修改起来，岂不是要发疯！</p>
<blockquote>
<p>什么是SpringCloud Config分布式配置中心</p>
</blockquote>
<p><img src="/2020/08/02/SpringCloud/image-20200801194254910.png" alt="image-20200801194254910" loading="lazy"></p>
<p>SpringCould Config为微服务架构中的微服务提供集中化的外部配置支持，配置服务器为每<strong>个不同微服务应用</strong>的所有环节提供了一个<strong>中心化的外部配置</strong>。</p>
<p>SpringCloud Config分为<strong>服务端</strong>和<strong>客户端</strong>两部分；</p>
<ul>
<li>服务端也成为分布式配置中心，它是一个独立的微服务应用，用来连接配置服务器为客户端提供配置信息，加密，解密信息等访问接口</li>
<li>客户端则是通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息。配置服务器默认采用git来存储配置信息，这样就有助于对环境配置进行版本管理。并且可以通过git客户端工具来方便的管理和访问配置内容。</li>
</ul>
<blockquote>
<p>SpringCloud Config配置中心能干嘛</p>
</blockquote>
<ul>
<li>集中管理配置文件</li>
<li>不同环境，不同配置，动态化的配置更新，分环境部署，比如 /dev  /test  /prop  /beta  /release</li>
<li>运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息</li>
<li>当配置发生变动时，服务不需要重启，即可感知到配置的变化，并应用新的配置【需要热部署插件】</li>
<li>将配置信息以REST接口的形式暴露</li>
</ul>
<blockquote>
<p>SpringCloud Config分布式配置中心与Github整合</p>
</blockquote>
<ul>
<li>由于SpringCloud Config默认使用Git来存储配置文件，也有其他方式，比如支持SVN和本地文件，但最推荐的还是Git，而且使用的是http/https访问的形式</li>
</ul>
<h3 id="10-2、环境搭建"><a href="#10-2、环境搭建" class="headerlink" title="10.2、环境搭建"></a>10.2、环境搭建</h3><ol>
<li><p>安装和使用Git：这个可以在docsify文档中查看</p>
</li>
<li><p>创建新仓库<code>springcloud_config</code></p>
</li>
<li><p>向仓库提交<code>application.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建模块<code>springcloud-config-server-3344</code></p>
</li>
<li><p>导入依赖（先不需要导入Eureka，不然会一直刷）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring-boot-starter-web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--actuator完善监控信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring-cloud-config-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3344</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-server</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/lxjblog/springcloud_config.git</span> <span class="comment"># 这里使用的是Https 不是SSH</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写主启动类<code>Config_Server_3344</code>，开启服务注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config_Server_3344</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Config_Server_3344.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动该项目测试，访问<code>application-dev.yml</code>，可以输出文件中的内容</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801215607431.png" alt="image-20200801215607431" loading="lazy"></p>
<p>因为我们在<code>application.yml</code>文件中使用了<code>---</code>形成多文档块</p>
</li>
</ol>
<blockquote>
<p>除此之外，还有以下几种访问方式：</p>
</blockquote>
<ul>
<li><p>application为文件名，profile为工作环境，label为分支（master）</p>
</li>
<li><p>/{application}/{profile}[/{label}]</p>
</li>
<li><p>/{application}-{profile}.yml    【上方就是这种】</p>
</li>
<li><p>/{label}/{application}-{profile}.yml</p>
</li>
<li><p>/{application}-{profile}.properties</p>
</li>
<li><p>/{label}/{application}-{profile}.properties</p>
</li>
</ul>
<h3 id="10-3、Config客户端"><a href="#10-3、Config客户端" class="headerlink" title="10.3、Config客户端"></a>10.3、Config客户端</h3><blockquote>
<p>对客户端来说只是访问本地文件，然后通过服务端帮我们去进行查询</p>
</blockquote>
<ol>
<li><p>创建<code>config-client.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8201</span></span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-provider-dept</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line">      </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8202</span></span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-provider-dept</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>提交到码云上</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801221259049.png" alt="image-20200801221259049" loading="lazy"></p>
</li>
<li><p>创建新模块<code>springcloud-config-client-3355</code></p>
</li>
<li><p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring-boot-starter-web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--actuator完善监控信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring-cloud-starter-config --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>bootstrap.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 系统级别的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config-client</span>   <span class="comment"># 需要从git上获取的文件名，不需要后缀</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span>    <span class="comment"># 工作环境</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span>   <span class="comment"># 主分支</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:3344</span>    <span class="comment"># 服务端的地址</span></span><br></pre></td></tr></table></figure>

<p>编写配置文件<code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 用户级别的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-client</span></span><br></pre></td></tr></table></figure>

<p>注意区别：</p>
<p><code>bootstrap</code>：是系统级别的配置，因为连接到远端可能会出错，所以这里使用这个</p>
<p><code>application</code>：用户级别的配置</p>
</li>
<li><p>编写控制类<code>ConfigClientController</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.application.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String applicationName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;eureka.client.service-url.defaultZone&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String eurekaServer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/config&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;applicationName: &quot;</span> + applicationName +</span><br><span class="line">                <span class="string">&quot;eurekaServer: &quot;</span> + eurekaServer +</span><br><span class="line">                <span class="string">&quot;port: &quot;</span> + port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写主启动类测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config_Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Config_Client.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动<code>3344</code>和当前项目进行测试</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801224244058.png" alt="image-20200801224244058" loading="lazy"></p>
<p>【注意：当前项目的端口号是8201，这是读取到git上的文件，因为在<code>bootstrap.yml</code>中我们配置了<code>profile: dev</code>  访问dev环境，**所以我们可以通过远端配置我们项目的端口号信息了，使代码可读性降低~**】</p>
</li>
<li><p>访问测试，成功读取到信息</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801225244514.png" alt="image-20200801225244514" loading="lazy"></p>
</li>
<li><p>当我们把<code>bootstrap.yml</code>文件的环境改为test</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">test</span>    <span class="comment"># 工作环境</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/02/SpringCloud/image-20200801225123260.png" alt="image-20200801225123260" loading="lazy"></p>
</li>
</ol>
<h3 id="10-4、远程配置实战"><a href="#10-4、远程配置实战" class="headerlink" title="10.4、远程配置实战"></a>10.4、远程配置实战</h3><h4 id="代码上传"><a href="#代码上传" class="headerlink" title="代码上传"></a>代码上传</h4><ol>
<li><p>编写远程配置<code>config-eureka.yml</code>集群的注册中心</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>  <span class="comment"># Eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># 表示是否向Eureka注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># 为false表示自己为注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># 监控页面</span></span><br><span class="line">      <span class="comment"># 集群（关联其他的注册中心）</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-eureka</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span>  <span class="comment"># Eureka服务端的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment"># 表示是否向Eureka注册中心注册自己</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span> <span class="comment"># 为false表示自己为注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span>  <span class="comment"># 监控页面</span></span><br><span class="line">      <span class="comment"># 集群（关联其他的注册中心）</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建<code>config-dept.yml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xj.springcloud.pojo</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-provider-dept</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db01?serverTimezone=GMT&amp;createDatabaseIfNotExist=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;autoReconnect=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">springcloud-provider-dept8001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># info配置</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">app.name:</span> <span class="string">xj-springcloud</span></span><br><span class="line">  <span class="attr">company.name:</span> <span class="string">lxjblog.gitee.io</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.xj.springcloud.pojo</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Spring的配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-provider-dept</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db02?serverTimezone=GMT&amp;createDatabaseIfNotExist=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;autoReconnect=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Eureka的配置，注册到哪里</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">springcloud-provider-dept8001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># info配置</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">app.name:</span> <span class="string">xj-springcloud</span></span><br><span class="line">  <span class="attr">company.name:</span> <span class="string">lxjblog.gitee.io</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>提交到码云上</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801230901167.png" alt="image-20200801230901167" loading="lazy"></p>
</li>
</ol>
<h4 id="获取文件"><a href="#获取文件" class="headerlink" title="获取文件"></a>获取文件</h4><ol>
<li><p>创建新模块<code>springcloud-config-eureka-7001</code></p>
</li>
<li><p>拷贝原来的内容</p>
</li>
<li><p>导入config依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring-cloud-starter-eureka-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--热部署工具--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring-cloud-starter-config --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>bootstrap.yml</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config-eureka</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:3344</span></span><br></pre></td></tr></table></figure>

<p>编写<code>application.yml</code>文件</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-eureka-7001</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动访问：启动<code>3344</code>，测试是否可以读取到信息</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801232501527.png" alt="image-20200801232501527" loading="lazy"></p>
<p>没问题，然后使用客户端进行连接，访问成功即可</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801233031253.png" alt="image-20200801233031253" loading="lazy"></p>
</li>
</ol>
<blockquote>
<p>创建新的8001提供者</p>
</blockquote>
<ol>
<li><p>创建新模块<code>springcloud-config-dept-8001</code></p>
</li>
<li><p>拷贝内容，依赖和代码</p>
</li>
<li><p>添加congfig的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-cloud-starter-config --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写配置文件<code>bootstrap.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config-dept</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:3344</span></span><br></pre></td></tr></table></figure>

<p><code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-config-dept-8001</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改启动类名称</p>
</li>
<li><p>启动项目测试</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801233919518.png" alt="image-20200801233919518" loading="lazy"></p>
</li>
<li><p>访问测试：成功查询出数据</p>
<p><img src="/2020/08/02/SpringCloud/image-20200801234042999.png" alt="image-20200801234042999" loading="lazy"></p>
</li>
</ol>
<p><strong>【注意：客户端会在程序启动的时候获取服务的配置文件信息，所以当你直接在git上修改数据之后，使用客户端获取到的数据仍然是更新前的，需要重新启动项目才会获取到新的数据】</strong></p>
<p><img src="/2020/08/02/SpringCloud/image-20200802102428335.png" alt="image-20200802102428335" loading="lazy"></p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">谢谢光临~</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>晓江</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://yoursite.com/2020/08/02/SpringCloud/" title="SpringCloud">http://yoursite.com/2020/08/02/SpringCloud/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/08/02/Ajax%E5%92%8CJson/" rel="prev" title="Ajax和Json"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Ajax和Json</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/08/02/springmvc/" rel="next" title="springmvc"><span class="post-nav-text">springmvc</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"></div><div id="valine-container"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function initValine() {
  const valineConfig = {"enable":true,"appId":"71BKFg13iJQvNsFNLGzHmK67-gzGzoHsz","appKey":"IiQx2mfEEjefvbUfSd66nBHd","placeholder":"留下你的评论呗","avatar":"robohash","pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = window.location.pathname
  new Valine(valineConfig)
}
setTimeout(initValine, 1000)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 晓江</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-08-04T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div><script>let date = new Date();
let today = (date.getMonth() + 1) + "-" + date.getDate()
if ("4-4,9-18".indexOf(today) !== -1) {
  document.documentElement.style.filter = "grayscale(1)";
}</script><div class="aplayer no-destroy" id="aplayer" data-id="5157675042" data-server="netease" data-type="playlist" data-fixed="true" data-theme="#0078E7" data-loop="all" data-order="random" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="0" data-listmaxheight="340px" data-storagename="metingjs"></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>