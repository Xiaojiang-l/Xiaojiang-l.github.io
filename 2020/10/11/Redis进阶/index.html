<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="晓江"><meta name="copyright" content="晓江"><meta name="generator" content="Hexo 5.0.0"><meta name="theme" content="hexo-theme-yun"><title>Redis进阶 | 云端小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.16/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => <!-- hexo-inject:begin --><!-- hexo-inject:end -->{
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><link rel="shortcut icon" type="image/svg+xml" href="/icon.jpg"><link rel="mask-icon" href="/icon.jpg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="云端小站" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"云端小站","version":"0.9.4","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"}};
  </script><meta name="description" content="Redis配置文件以更多的应用讲解">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis进阶">
<meta property="og:url" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/index.html">
<meta property="og:site_name" content="云端小站">
<meta property="og:description" content="Redis配置文件以更多的应用讲解">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914194156161.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914114813892.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914114943886.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914115052707.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914115322270.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914120132745.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914120911975.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914121137841.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914123401931.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914190416226.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914191216239.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914191353567.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914192123334.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914193912551.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914194823973.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914200152043.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914222154370.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914223659089.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201006130959155.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010131246453.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010132413370.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010143450266.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145159860.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145721122.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145752720.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145815432.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010150212743.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010150727364.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010150828084.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010151405846.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010152643314.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010152919484.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010153213094.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010153220476.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010153343247.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010214839412.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010220157178.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010220510702.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010222655546.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010222954574.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010223043270.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011170555271.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011171055323.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011171300066.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011172517422.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011172704790.png">
<meta property="article:published_time" content="2020-10-11T09:46:50.000Z">
<meta property="article:modified_time" content="2020-10-11T09:51:43.429Z">
<meta property="article:author" content="晓江">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="nosql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914194156161.png"><script src="/js/ui/mode.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="晓江"><img width="96" loading="lazy" src="/icon.jpg" alt="晓江"></a><div class="site-author-name"><a href="/about/">晓江</a></div><a class="site-name" href="/about/site.html">云端小站</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">45</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">15</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">49</span></a></div><a class="site-state-item hty-icon-button" href="https://lxjblog.gitee.io/myblog" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/wechat/" title="微信" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1256240778&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Xiaojiang-l" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/playlist?id=5157675042" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:1256240778@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis%E8%BF%9B%E9%98%B6"><span class="toc-text">Redis进阶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Redis-conf%E8%AF%A6%E8%A7%A3"><span class="toc-text">1、Redis.conf详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">2、Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81RDB%EF%BC%88Redis-DataBase%EF%BC%89"><span class="toc-text">1、RDB（Redis DataBase）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81AOF%EF%BC%88Append-Only-File%EF%BC%89"><span class="toc-text">2、AOF（Append Only File）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-text">3、Redis发布订阅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">4、主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">1、环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%8E%E9%85%8D%E7%BD%AE"><span class="toc-text">2、一主二从配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="toc-text">3、哨兵模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81Redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-text">5、Redis缓存穿透和雪崩（重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%EF%BC%88%E6%9F%A5%E4%B8%8D%E5%88%B0%E5%AF%BC%E8%87%B4%EF%BC%89"><span class="toc-text">1、缓存穿透（查不到导致）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%EF%BC%88%E9%87%8F%E5%A4%AA%E5%A4%A7%EF%BC%8C%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F%EF%BC%89"><span class="toc-text">2、缓存击穿（量太大，缓存过期）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-text">3、缓存雪崩</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="晓江"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="云端小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Redis进阶</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-10-11 17:46:50" itemprop="dateCreated datePublished" datetime="2020-10-11T17:46:50+08:00">2020-10-11</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">数据库</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">数据库</span></a><a class="tag" href="/tags/nosql/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">nosql</span></a></span></div><div class="post-author"><div class="author-avatar"><img src="https://img-blog.csdnimg.cn/20210628000220859.jpg"></div><span class="author-name">晓江</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="Redis进阶"><a href="#Redis进阶" class="headerlink" title="Redis进阶"></a>Redis进阶</h2><h2 id="1、Redis-conf详解"><a href="#1、Redis-conf详解" class="headerlink" title="1、Redis.conf详解"></a>1、Redis.conf详解</h2><p>这是Redis中的一个配置文件</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914194156161.png" alt="image-20200914194156161" loading="lazy"></p>
<blockquote>
<p>单位</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914114813892.png" alt="image-20200914114813892" loading="lazy"></p>
<p>配置文件unit单位对大小写不敏感</p>
<blockquote>
<p>包含</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914114943886.png" alt="image-20200914114943886" loading="lazy"></p>
<p>例如学习java的import、include</p>
<blockquote>
<p>网路</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914115052707.png" alt="image-20200914115052707" loading="lazy"></p>
<pre class=" language-bash"><code class="language-bash">bind 127.0.0.1    <span class="token comment" spellcheck="true"># 绑定的ip</span>
protected-mode <span class="token function">yes</span>    <span class="token comment" spellcheck="true"># 保护模式</span>
port 6379    <span class="token comment" spellcheck="true"># 端口的设置</span></code></pre>
<blockquote>
<p>通用GENERAL</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914115322270.png" alt="image-20200914115322270" loading="lazy"></p>
<pre class=" language-bash"><code class="language-bash">daemonize no    <span class="token comment" spellcheck="true"># 以守护进程的方式运行，默认为no，我们需要自己开启为yes！</span>

pidfile /var/run/redis_6379.pid        <span class="token comment" spellcheck="true"># 如果上面那个设置为yes，那就需要指定一个pid进程文件</span>

<span class="token comment" spellcheck="true"># 日志</span>
<span class="token comment" spellcheck="true"># Specify the server verbosity level.</span>
<span class="token comment" spellcheck="true"># This can be one of:</span>
<span class="token comment" spellcheck="true"># debug (a lot of information, useful for development/testing)</span>
<span class="token comment" spellcheck="true"># verbose (many rarely useful info, but not a mess like the debug level)</span>
<span class="token comment" spellcheck="true"># notice (moderately verbose, what you want in production probably)</span>
<span class="token comment" spellcheck="true"># warning (only very important / critical messages are logged)</span>
loglevel notice
logfile <span class="token string">""</span>    <span class="token comment" spellcheck="true">#日志文件名</span>
databases 16    <span class="token comment" spellcheck="true"># 数据库的数量，默认为16个数据库</span>
always-show-logo <span class="token function">yes</span>    <span class="token comment" spellcheck="true"># 是否在启动的时候显示Logo</span></code></pre>
<blockquote>
<p>快照</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914120132745.png" alt="image-20200914120132745" loading="lazy"></p>
<p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件<code>.rdb</code>、<code>.aof</code></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 如果在900秒内进行了1 key修改，就会进行持久化操作</span>
save 900 1
<span class="token comment" spellcheck="true"># 如果在300秒内进行了10 key修改，就会进行持久化操作</span>
save 300 10
<span class="token comment" spellcheck="true"># 如果在60秒内进行了10000 key修改，就会进行持久化操作</span>
save 60 10000

<span class="token comment" spellcheck="true"># 持久化如果出错了，是否还继续进行操作</span>
stop-writes-on-bgsave-error <span class="token function">yes</span>

<span class="token comment" spellcheck="true"># 是否压缩rdb文件，需要消耗一些cpu资源</span>
rdbcompression <span class="token function">yes</span>

<span class="token comment" spellcheck="true"># 保存rdb文件的时候是否进行错误的检查校验</span>
rdbchecksum <span class="token function">yes</span>

<span class="token comment" spellcheck="true"># rdb文件保存的目录</span>
<span class="token function">dir</span> ./</code></pre>
<blockquote>
<p>REPLICATION 复制（在主从复制的部分讲解）</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914120911975.png" alt="image-20200914120911975" loading="lazy"></p>
<blockquote>
<p>SECURITY</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914121137841.png" alt="image-20200914121137841" loading="lazy"></p>
<p>可以在这里设置密码，默认没有密码</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试连接</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token function">ping</span>
PONG
<span class="token comment" spellcheck="true"># 查看密码</span>
127.0.0.1:6379<span class="token operator">></span> config get requirepass
1<span class="token punctuation">)</span> <span class="token string">"requirepass"</span>
2<span class="token punctuation">)</span> <span class="token string">""</span>
<span class="token comment" spellcheck="true"># 设置密码</span>
127.0.0.1:6379<span class="token operator">></span> config <span class="token keyword">set</span> requirepass <span class="token string">"123456"</span>
OK
<span class="token comment" spellcheck="true"># 此时所有命令会没有权限，需要设置密码</span>
127.0.0.1:6379<span class="token operator">></span> auth 123456
OK</code></pre>
<blockquote>
<p>限制 CLIENTS</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914123401931.png" alt="image-20200914123401931" loading="lazy"></p>
<pre class=" language-bash"><code class="language-bash">maxclients 10000    <span class="token comment" spellcheck="true"># 最大客户端数量</span>

maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">></span>    <span class="token comment" spellcheck="true"># 最大的内存容量</span>

maxmemory-policy noeviction    <span class="token comment" spellcheck="true"># 内存到达上限之后的处理策略，可以移除过期的key、报错等</span>
    1. volatile-lru:从已设置过期时间的内存数据集中挑选最近最少使用的数据 淘汰；
    2. volatile-ttl: 从已设置过期时间的内存数据集中挑选即将过期的数据 淘汰；
    3. volatile-random:从已设置过期时间的内存数据集中任意挑选数据 淘汰；
    4. allkeys-lru:从内存数据集中挑选最近最少使用的数据 淘汰；
    5. allkeys-random:从数据集中任意挑选数据 淘汰；
    6. noeviction<span class="token punctuation">(</span>驱逐<span class="token punctuation">)</span>：禁止驱逐数据。（默认淘汰策略。当redis内存数据达到maxmemory，在该策略下，直接返回OOM错误）；</code></pre>
<blockquote>
<p>APPEND ONLY 模式 aof配置</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">appendonly no    <span class="token comment" spellcheck="true"># 默认不开启aof模式，默认使用rdb方式持久化，在大部分情况下rdb够用了</span>

appendfilename <span class="token string">"appendonly.aof"</span>    <span class="token comment" spellcheck="true"># 持久化文件的名字</span>

<span class="token comment" spellcheck="true"># appendfsync always    # 每次修改都会sync，消耗性能，速度最慢</span>
appendfsync everysec    <span class="token comment" spellcheck="true"># 每秒执行一次sync</span>
<span class="token comment" spellcheck="true"># appendfsync no        # 不执行sync，这时候操作系统自己同步数据，速度最快</span></code></pre>
<h2 id="2、Redis持久化"><a href="#2、Redis持久化" class="headerlink" title="2、Redis持久化"></a>2、Redis持久化</h2><p>Redis使内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出（执行shutdown命令），服务器中的数据库状态也会消失，所以Redis提供了持久化功能！</p>
<h3 id="1、RDB（Redis-DataBase）"><a href="#1、RDB（Redis-DataBase）" class="headerlink" title="1、RDB（Redis DataBase）"></a>1、RDB（Redis DataBase）</h3><blockquote>
<p>什么是RDB</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914190416226.png" alt="image-20200914190416226" loading="lazy"></p>
<p>在指定的时间间隔内将内存中的数据快照写入磁盘，也就是Snapshot快照，它恢复时是将快照文件直接读到内存中。</p>
<p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，在用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那么<code>RDB</code>方式要比<code>AOF</code>方式更加高效。默认的就是RDB方式，一般不需要修改这个配置！</p>
<p><code>RDB</code>的缺点就是最后一次持久化后的数据可能丢失。</p>
<p><strong>rdb保存的文件是dump.rdb</strong>，都是在配置文件中的快照中进行配置的！</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914191216239.png" alt="image-20200914191216239" loading="lazy"></p>
<blockquote>
<p>修改配置文件进行测试</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914191353567.png" alt="image-20200914191353567" loading="lazy"></p>
<p>新创建一个窗口并在一分钟内进行5个 key 的操作，这时就会触发保存机制</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914192123334.png" alt="image-20200914192123334" loading="lazy"></p>
<blockquote>
<p>触发机制</p>
</blockquote>
<ol>
<li>save的规则满足的情况下，会自动触发rdb规则</li>
<li>执行 flushall 命令，也会触发rdb规则</li>
<li>退出redis，也会产生rdb文件</li>
</ol>
<p>备份就自动生成一个dump.rdb文件</p>
<blockquote>
<p>恢复rdb文件</p>
</blockquote>
<ol>
<li><p>只需要将rdb文件放在redis启动目录就可以了，redis启动的时候会自动检查dump.rdb 恢复其中的数据！</p>
</li>
<li><p>查看需要存放的位置</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> config get <span class="token function">dir</span>
1<span class="token punctuation">)</span> <span class="token string">"dir"</span>
2<span class="token punctuation">)</span> <span class="token string">"/usr/local/bin"</span>        <span class="token comment" spellcheck="true"># 如果在这个目录下存放dump.rdb文件，启动就会自动恢复其中的数据</span></code></pre>
</li>
</ol>
<blockquote>
<p>优缺点</p>
</blockquote>
<p><strong>优点：</strong></p>
<ol>
<li>适合大规模的数据恢复！</li>
<li>如果对数据完整性不高，就适合使用（因为save的规则不一定在宕机前满足保存规则）！</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>需要一定的时间间隔进程操作！如果redis意外宕机，这个最后一次修改的数据就没有了！</li>
<li>fork进程的时候，会占用一定的内存空间！</li>
</ol>
<h3 id="2、AOF（Append-Only-File）"><a href="#2、AOF（Append-Only-File）" class="headerlink" title="2、AOF（Append Only File）"></a>2、AOF（Append Only File）</h3><p>将我们的所有命令都记录下来，恢复的时候就这个文件全部在执行一遍！</p>
<blockquote>
<p>什么是AOF</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914193912551.png" alt="image-20200914193912551" loading="lazy"></p>
<p>以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录，因为对数据不影响），只许追加文件但不可以改写文件，redis启动之初会读取文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作！</p>
<p><strong>AOF保存的是 appendonly.aof文件</strong></p>
<blockquote>
<p>append</p>
</blockquote>
<p>进入配置文件<code>vim myconfig/redis.conf</code>，输入/append就可以直接搜索出这部分的内容</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914194823973.png" alt="image-20200914194823973" loading="lazy"></p>
<p>默认是不开启的，需要自己手动配置，改为yes即可。修改了配置文件之后重启一下，redis就可以生效了！</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914200152043.png" alt="image-20200914200152043" loading="lazy"></p>
<p>如果这个aof文件有错误，这时候redis是启动不起来的，我们需要修复这个aof文件</p>
<p>redis给我们提供了一个工具<code>redis-check-aof --fix</code></p>
<pre class=" language-bash"><code class="language-bash">redis-check-aof --fix appendonly.aof</code></pre>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914222154370.png" alt="image-20200914222154370" loading="lazy"></p>
<p>如果文件正常，重启就可以直接恢复了！</p>
<blockquote>
<p>重写规则</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20200914223659089.png" alt="image-20200914223659089" loading="lazy"></p>
<p>如果aof文件大于64m，将会fork一个新的进城来将我们的文件进行重写，aof默认就是文件的无限追加，文件就会越来越大！</p>
<blockquote>
<p>Aof配置</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">appendonly no    <span class="token comment" spellcheck="true"># 默认不开启aof模式，默认使用rdb方式持久化，在大部分情况下rdb够用了</span>

appendfilename <span class="token string">"appendonly.aof"</span>    <span class="token comment" spellcheck="true"># 持久化文件的名字</span>

<span class="token comment" spellcheck="true"># appendfsync always    # 每次修改都会sync，消耗性能，速度最慢</span>
appendfsync everysec    <span class="token comment" spellcheck="true"># 每秒执行一次sync</span>
<span class="token comment" spellcheck="true"># appendfsync no        # 不执行sync，这时候操作系统自己同步数据，速度最快</span></code></pre>
<blockquote>
<p>优缺点</p>
</blockquote>
<p><strong>优点：</strong></p>
<ol>
<li>appendfsync always：每一次修改都同步，文件的完整性会更加好</li>
<li>appendfsync everysec：每秒同步一次，可能会丢失一秒的数据</li>
<li>appendfsync no：从不同步，效率最高</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>相对于数据文件来说，aof远远大于rdb，修复速度也比rdb慢</li>
<li>aof运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化</li>
</ol>
<blockquote>
<p>总结</p>
</blockquote>
<ol>
<li><p>如果只做缓存，只希望数据在服务器运行的时候存在，就可以不使用任何持久化</p>
</li>
<li><p>如果同时开启两种持久化方式：</p>
<p>redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</p>
</li>
<li><p>性能建议：</p>
<p>因为RDB文件只用作后备用途，建议只在slave上持久化文件，只要15分钟备份一次就够了，只保留save 900 1这条规则。</p>
<p>如果使用Enable AOF，好处是最多只会丢失不超过两秒的数据。</p>
<p>如果不使用Enable AOF，则可以省下一大笔IO，如果Master/Slava同时倒掉，会丢失十几分钟的数据。</p>
</li>
</ol>
<h2 id="3、Redis发布订阅"><a href="#3、Redis发布订阅" class="headerlink" title="3、Redis发布订阅"></a>3、Redis发布订阅</h2><blockquote>
<p>Redis发布订阅（pub/sub）是一种<strong>消息通信模式</strong>：发送者（pub）发送消息，订阅者（sub）接收消息</p>
</blockquote>
<p>Redis客户端可以订阅任意数量的频道</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201006130959155.png" alt="image-20201006130959155" loading="lazy"></p>
<blockquote>
<p>命令</p>
</blockquote>
<ul>
<li>订阅：SUBSCRIBE 频道名称</li>
<li>发布：PUBLISH 频道名称 信息内容</li>
</ul>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010131246453.png" alt="image-20201010131246453" loading="lazy"></p>
<blockquote>
<p>测试</p>
</blockquote>
<ol>
<li><p>使用客户端连接Redis，作为<code>订阅者</code></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 连接Redis</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-cli -p 6379</span>

<span class="token comment" spellcheck="true"># 进行订阅</span>
127.0.0.1:6379<span class="token operator">></span> SUBSCRIBE xiaojiang
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
1<span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
2<span class="token punctuation">)</span> <span class="token string">"xiaojiang"</span>
3<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
<span class="token comment" spellcheck="true"># 下面将会自动接收消息</span></code></pre>
</li>
<li><p>新打开一个窗口连接Redis，作为<code>发布者</code></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 进入bin目录</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /usr/local/bin</span>

<span class="token comment" spellcheck="true"># 连接Redis</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-cli -p 6379</span>

<span class="token comment" spellcheck="true"># 发布消息</span>
127.0.0.1:6379<span class="token operator">></span> PUBLISH xiaojiang <span class="token string">"hello world!"</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1</code></pre>
</li>
<li><p>查看接收结果</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010132413370.png" alt="image-20201010132413370" loading="lazy"></p>
</li>
</ol>
<blockquote>
<p>使用场景</p>
</blockquote>
<ol>
<li>实时消息系统</li>
<li>实时聊天（把频道当成聊天室，将信息回显给所有人即可）</li>
<li>订阅，关注系统</li>
</ol>
<p>稍微复杂的场景就需要使用 消息中间件MQ</p>
<h2 id="4、主从复制"><a href="#4、主从复制" class="headerlink" title="4、主从复制"></a>4、主从复制</h2><blockquote>
<p>概念</p>
</blockquote>
<p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器，前者称为主节点（master/leader），后者称为从节点（slave/follower），数据的复制是单向的，<strong>只能由主节点到从节点</strong>。</p>
<ul>
<li>master以写为主</li>
<li>slave以读为主</li>
</ul>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010143450266.png" alt="image-20201010143450266" loading="lazy"></p>
<p>主从复制，读写分离！80%的情况下都是在进行读操作！减缓服务器的压力！架构中经常使用！</p>
<blockquote>
<p>主从复制的作用</p>
</blockquote>
<ol>
<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</li>
<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一个服务的冗余。</li>
<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务。</li>
<li>高可用基石：主从复制还是哨兵和集群能够实施的基础。</li>
</ol>
<p>一般来说，要将Redis运用于工程项目中，只使用一台Redis是不够的（可能会宕机），<strong>单台Redis的最大使用内存不应该超过20G</strong>。</p>
<h3 id="1、环境配置"><a href="#1、环境配置" class="headerlink" title="1、环境配置"></a>1、环境配置</h3><p>只配置从库，不配置主库！</p>
<blockquote>
<p>查看当前Redis的主从复制信息</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 获取单钱库的信息</span>
127.0.0.1:6379<span class="token operator">></span> info replication
<span class="token comment" spellcheck="true"># Replication</span>
role:master        <span class="token comment" spellcheck="true"># 角色 master</span>
connected_slaves:0        <span class="token comment" spellcheck="true"># 没有从机</span>
master_replid:dc9fc3998a4785d3f96ef406fe19fa44bd4031b2
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0</code></pre>
<blockquote>
<p>测试</p>
</blockquote>
<ol>
<li><p>打开四个服务器连接，前三个做服务集群，第四个做测试</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145159860.png" alt="image-20201010145159860" loading="lazy"></p>
</li>
<li><p>要启动多个redis服务，就必须配置多个redis配置文件</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd myconfig</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
redis.conf

<span class="token comment" spellcheck="true"># 复制三个redis配置文件</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp redis.conf redis79.conf</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp redis.conf redis80.conf</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp redis.conf redis81.conf</span>

<span class="token comment" spellcheck="true"># 查看是否创建成功</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
redis.conf  redis79.conf  redis80.conf  redis81.conf</code></pre>
</li>
<li><p>将复制的配置文件改为对应的端口号</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 依次修改文件</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim redis79.conf  </span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim redis80.conf</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim redis81.conf</span></code></pre>
<p>修改如下四处（对于redis79.conf只需要修改后面两处）</p>
<ol>
<li>端口</li>
<li>pid 名字</li>
<li>log 文件名字</li>
<li>dump.rdb 名字</li>
</ol>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145721122.png" alt="image-20201010145721122" loading="lazy"></p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145752720.png" alt="image-20201010145752720" loading="lazy"></p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010145815432.png" alt="image-20201010145815432" loading="lazy"></p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010150212743.png" alt="image-20201010150212743" loading="lazy"></p>
</li>
<li><p>启动服务</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在前三个端口中进行对应指令</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /usr/local/bin</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-server myconfig/redis79.conf </span></code></pre>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010150727364.png" alt="image-20201010150727364" loading="lazy"></p>
</li>
<li><p>查看服务是否启动成功</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看产生的日志文件</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls </span>

<span class="token comment" spellcheck="true"># 查看Redis的后台进程</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ps -ef|grep redis</span></code></pre>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010150828084.png" alt="image-20201010150828084" loading="lazy"></p>
</li>
</ol>
<h3 id="2、一主二从配置"><a href="#2、一主二从配置" class="headerlink" title="2、一主二从配置"></a>2、一主二从配置</h3><blockquote>
<p>默认情况下，每一台Redis都是主节点</p>
</blockquote>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010151405846.png" alt="image-20201010151405846" loading="lazy"></p>
<p>我们一般情况下只要配置从机就好了！</p>
<blockquote>
<p>一主（79）二从（80、81）</p>
</blockquote>
<ol>
<li><p>在两台从机中执行如下指令</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 认领ip地址为127.0.0.1的6379端口为主机</span>
127.0.0.1:6380<span class="token operator">></span> SLAVEOF 127.0.0.1 6379

<span class="token comment" spellcheck="true"># 查看当前自己的信息</span>
127.0.0.1:6380<span class="token operator">></span> info replication
<span class="token comment" spellcheck="true"># Replication</span>
role:slave        <span class="token comment" spellcheck="true"># 角色变为从机</span>
master_host:127.0.0.1        <span class="token comment" spellcheck="true"># 主机地址</span>
master_port:6379        <span class="token comment" spellcheck="true"># 主机端口</span>
master_link_status:up
master_last_io_seconds_ago:6
master_sync_in_progress:0
slave_repl_offset:14
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:df35ec1b9a90e6170861ab1a70e4849d2a8a57c8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:14
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:14</code></pre>
</li>
<li><p>此时再次查看主机的信息</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> info replication
<span class="token comment" spellcheck="true"># Replication</span>
role:master        <span class="token comment" spellcheck="true"># 79已经成为了主机</span>
connected_slaves:2        <span class="token comment" spellcheck="true"># 下面拥有两台从机</span>
slave0:ip<span class="token operator">=</span>127.0.0.1,port<span class="token operator">=</span>6380,state<span class="token operator">=</span>online,offset<span class="token operator">=</span>140,lag<span class="token operator">=</span>1
slave1:ip<span class="token operator">=</span>127.0.0.1,port<span class="token operator">=</span>6381,state<span class="token operator">=</span>online,offset<span class="token operator">=</span>140,lag<span class="token operator">=</span>1
master_replid:df35ec1b9a90e6170861ab1a70e4849d2a8a57c8
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:140
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:140</code></pre>
</li>
</ol>
<p>真实的主从配置应该在配置文件中配置，这样的话才是永久的，我们这里使用的是命令，只是暂时的！</p>
<blockquote>
<p>配置文件修改</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 进行配置文件修改</span>
<span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz myconfig<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim redis80.conf</span></code></pre>
<p>配置主机信息</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010152643314.png" alt="image-20201010152643314" loading="lazy"></p>
<p>重启Redis之后发现配置文件依然生效</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010152919484.png" alt="image-20201010152919484" loading="lazy"></p>
<blockquote>
<p>细节</p>
</blockquote>
<p>主机可以写，从机不能写只能读！主机中的所有信息和数据都会被从机自动保存！</p>
<ol>
<li><p>在主机中设置值</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010153213094.png" alt="image-20201010153213094" loading="lazy"></p>
</li>
<li><p>在从机中可以获取对应的值</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010153220476.png" alt="image-20201010153220476" loading="lazy"></p>
</li>
<li><p>而在从机中设置值会报错</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010153343247.png" alt="image-20201010153343247" loading="lazy"></p>
</li>
</ol>
<blockquote>
<p>主机宕机的情况</p>
</blockquote>
<p>所以如果主机宕机了，从机的内容还存在（并且从机还是从机），此时已经没有主机了，这个时候没有了写操作。</p>
<p>而当主机重新连接上了之后，则会恢复到之前的状态，从机依然会自动保存主机的内容。</p>
<blockquote>
<p>从机宕机的情况</p>
</blockquote>
<p><strong>情况一：使用命令行配置的从机</strong></p>
<ol>
<li>当该从机宕机之后，主机的从机就会减少一个</li>
<li>在从机宕机期间，主机新增数据</li>
<li>当从机恢复连接之后，会发现该从机已经自动变回了一台主机，所以<strong>获取不到</strong>在宕机期间主机设置的值</li>
<li>再次进行命令行的配置，将该服务设置为从机，此时发现可以获取到宕机期间主机设置的值</li>
</ol>
<p><strong>情况二：使用配置文件设置的从机</strong></p>
<ol>
<li>当该从机恢复连接之后，它依旧是一台从机，并且可以获取到宕机期间设置的值</li>
</ol>
<blockquote>
<p>复制原理</p>
</blockquote>
<ol>
<li>Slave从机 启动成功连接到 Master主机 后会发送一个sync同步命令</li>
<li>Master 接收到命令，启动后台的存盘进程，同时手机所有接收到的用于修改数据集命令</li>
<li><strong>在后台进程执行完毕之后，master将传送整个数据文件到slave，并完成一次完全同步</strong></li>
</ol>
<p><strong>全量复制</strong>：slave服务在接收到数据库文件数据后，将其存盘并加载到内存中</p>
<p><strong>增量复制</strong>：master继续将新的所有收集到的修改命令依次传给slave，完成同步</p>
<p>但是只要是重新连接master，一次完全同步（全量复制）将被自动执行</p>
<blockquote>
<p>层层链路</p>
</blockquote>
<p>一个从节点连接到上一个从节点！</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010214839412.png" alt="image-20201010214839412" loading="lazy"></p>
<p>这个时候也可以完成主从复制，但80依旧是从节点！</p>
<blockquote>
<p>主节点断开之后，自动选择下一个主节点</p>
</blockquote>
<p><em>如果将主从复制在配置文件中修改的，那这一步将会比较麻烦</em></p>
<p><strong>谋朝篡位</strong></p>
<p>如果主机断开了连接，我们可以使用<code>SLAVEOF no one</code>使自己变成主机！其他节点就可以手动连接到最新的主节点（手动）！</p>
<p>这个时候如果主机重新连接上了，也没有效果了，需要重新连接！</p>
<h3 id="3、哨兵模式"><a href="#3、哨兵模式" class="headerlink" title="3、哨兵模式"></a>3、哨兵模式</h3><p><em>自动选举老大的模式</em></p>
<blockquote>
<p>概述</p>
</blockquote>
<p>主从切换技术的方法是：当主服务器宕机后，需要手动把一个从节点切换为主节点，这个需要人工干预，费时费力，还会造成一段时间内服务不可用。</p>
<p><strong>谋朝篡位的自动版</strong>，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换未主库。</p>
<p>哨兵模式是一种特殊的模式，首先Redis提供哨兵的命令，哨兵是一个独立的进程，作为进程，他会独立运行。其原理是<strong>哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</strong></p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010220157178.png" alt="image-20201010220157178" loading="lazy"></p>
<blockquote>
<p>哨兵的作用</p>
</blockquote>
<ol>
<li>通过发送命令，让Redis服务器返回将恐其运行状态，包括主服务器和从服务器</li>
<li>当哨兵检测到master宕机，会自动将slave切换到master，然后通过<strong>发布订阅模式</strong>通知其他的从服务器，修改配置文件，让他们却换主机。</li>
</ol>
<blockquote>
<p>多哨兵模式</p>
</blockquote>
<p>当只有一个哨兵进行监控的时候可能会出现问题，因此需要进行多哨兵模式进行监控，各个哨兵之间也会进行相互监控！但该模式需要开启更多的进程！</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010220510702.png" alt="image-20201010220510702" loading="lazy"></p>
<p><strong>监控过程：</strong></p>
<ol>
<li>假设主服务器宕机了，哨兵1检测到这个结果，系统不会马上进行failover [故障转移]过程，仅仅是一个哨兵认为主服务器不可以用，这个现象称为<strong>主观下线</strong></li>
<li>当后面的哨兵也检测到主服务器不可用了，并且数量达到了一定值时，那么哨兵就会进行一次投票</li>
<li>如果投票结果通过，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>，然后通过再次投票<strong>选出新的主服务器</strong></li>
</ol>
<p><strong>测试：</strong></p>
<ol>
<li><p>在<code>myconfig</code>目录下新创建文件<code>sentinel.conf</code></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /usr/local/bin/myconfig

<span class="token comment" spellcheck="true"># 创建文件</span>
vim sentinel.conf</code></pre>
</li>
<li><p>编写内容</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># sentinel monitor 被监控的名称 host port 1</span>
sentinel monitor myredis 127.0.0.1 6379 1</code></pre>
<p>后面的 1 表示，当主机挂了，slave投票看让谁接替为主机，票数最多的就会称为主机</p>
</li>
<li><p>启动哨兵</p>
<pre class=" language-bash"><code class="language-bash">redis-sentinel myconfig/sentinel.conf</code></pre>
<p>启动结果</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@iz2ze2js0u6m077omgcbzmz bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-sentinel myconfig/sentinel.conf</span>
10974:X 10 Oct 2020 22:23:08.927 <span class="token comment" spellcheck="true"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
10974:X 10 Oct 2020 22:23:08.927 <span class="token comment" spellcheck="true"># Redis version=6.0.6, bits=64, commit=00000000, modified=0, pid=10974, just started</span>
10974:X 10 Oct 2020 22:23:08.927 <span class="token comment" spellcheck="true"># Configuration loaded</span>
                _._                                                  
           _.-``__ <span class="token string">''</span>-._                                             
      _.-`<span class="token variable"><span class="token variable">`</span>    <span class="token variable">`</span></span><span class="token keyword">.</span>  `_.  <span class="token string">''</span>-._           Redis 6.0.6 <span class="token punctuation">(</span>00000000/0<span class="token punctuation">)</span> 64 bit
  .-`<span class="token variable"><span class="token variable">`</span> .-<span class="token variable">`</span></span>`<span class="token variable"><span class="token variable">`</span><span class="token keyword">.</span>  <span class="token variable">`</span></span>``\/    _.,_ <span class="token string">''</span>-._                                   
 <span class="token punctuation">(</span>    <span class="token string">'      ,       .-<span class="token variable"><span class="token variable">`</span>  <span class="token operator">|</span> <span class="token variable">`</span></span>,    )     Running in sentinel mode
 |<span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-...-<span class="token variable"><span class="token variable">`</span> __<span class="token punctuation">..</span>.-.<span class="token variable">`</span></span>`-._|'</span>` _.-<span class="token string">'|     Port: 26379
 |    <span class="token variable"><span class="token variable">`</span>-._   <span class="token variable">`</span></span>._    /     _.-'</span>    <span class="token operator">|</span>     PID: 10974
  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._  `-./  _.-<span class="token string">'    _.-'</span>                                   
 <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    `-.__.-<span class="token string">'    _.-'</span>_.-<span class="token string">'|                                  
 |    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._        _.-'</span>_.-<span class="token string">'    |           http://redis.io        
  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._`-.__.-'</span>_.-<span class="token string">'    _.-'</span>                                   
 <span class="token operator">|</span><span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._    `-.__.-<span class="token string">'    _.-'</span>_.-<span class="token string">'|                                  
 |    <span class="token variable"><span class="token variable">`</span>-._<span class="token variable">`</span></span>-._        _.-'</span>_.-<span class="token string">'    |                                  
  <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-._`-.__.-'</span>_.-<span class="token string">'    _.-'</span>                                   
      <span class="token variable"><span class="token variable">`</span>-._    <span class="token variable">`</span></span>-.__.-<span class="token string">'    _.-'</span>                                       
          `-._        _.-<span class="token string">'                                           
              `-.__.-'</span>                                               

10974:X 10 Oct 2020 22:23:08.929 <span class="token comment" spellcheck="true"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
10974:X 10 Oct 2020 22:23:08.930 <span class="token comment" spellcheck="true"># Sentinel ID is c59290b3611548bba760b2eda2111a686758aa96</span>
10974:X 10 Oct 2020 22:23:08.930 <span class="token comment" spellcheck="true"># +monitor master myredis 127.0.0.1 6379 quorum 1</span>
10974:X 10 Oct 2020 22:23:08.931 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379
10974:X 10 Oct 2020 22:23:08.933 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379</code></pre>
</li>
<li><p>启动三个redis服务</p>
</li>
<li><p>将主服务器断开连接</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010222655546.png" alt="image-20201010222655546" loading="lazy"></p>
<p>此时哨兵不会立马进行处理，而是等待一点时间之后进行投票确定，并选举出新的主服务器（下方为哨兵日志）</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010222954574.png" alt="image-20201010222954574" loading="lazy"></p>
</li>
<li><p>此时可以看到80已经成为了主服务器，选举是根据自带的算法</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201010223043270.png" alt="image-20201010223043270" loading="lazy"></p>
</li>
</ol>
<blockquote>
<p>主机重新连接</p>
</blockquote>
<p>如果主机此时回来了，等待哨兵判断之后，原主机只能当作从机，这就是哨兵模式的规则！</p>
<p><em>即主机一旦断开之后，即使再次连接上，也只能充当从机了</em></p>
<blockquote>
<p>哨兵模式</p>
</blockquote>
<p>优点：</p>
<ol>
<li>哨兵集群，基于主从复制模式，所有的主从配置有点都有</li>
<li>主从可以切换，故障可以转移，系统的可用性就会更好</li>
<li>哨兵模式就是主从模式的升级，手动到自动，更加健壮！</li>
</ol>
<p>缺点：</p>
<ol>
<li>Redis不好在线扩容，集群容量一旦到达上限，在线扩容就十分麻烦</li>
<li>实现哨兵模式的配置其实是很麻烦，有很多配置选择</li>
</ol>
<blockquote>
<p>哨兵模式的配置</p>
</blockquote>
<p>参考网站：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xuliangxing/p/7149322.html">https://www.cnblogs.com/xuliangxing/p/7149322.html</a></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 配置监听端口号，默认26379，可用于集群配置</span>
port 26379

<span class="token comment" spellcheck="true"># 监听地址</span>
sentinel monitor myredis 127.0.0.1 6379 1

<span class="token comment" spellcheck="true"># 设置连接master和slave时的密码</span>
sentinel auth-pass <span class="token operator">&lt;</span>master-name<span class="token operator">></span> <span class="token operator">&lt;</span>password<span class="token operator">></span>

<span class="token comment" spellcheck="true"># 指定需要多少失效时间，一个master才会被这个sentinel主观地认为是不可用的。 单位是毫秒，默认为30秒</span>
sentinel down-after-milliseconds mymaster 30000

<span class="token comment" spellcheck="true"># 指定在发生failover主备切换时最多可以有多少个slave同时对新的master进行同步。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态</span>
sentinel parallel-syncs myredis 1
</code></pre>
<h2 id="5、Redis缓存穿透和雪崩（重点）"><a href="#5、Redis缓存穿透和雪崩（重点）" class="headerlink" title="5、Redis缓存穿透和雪崩（重点）"></a>5、Redis缓存穿透和雪崩（重点）</h2><p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面，但同时，它带来了一些问题。其中，最要害的问题就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据一致性要求很高，那么就不能使用缓存。</p>
<p>另外的一些典型的问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011170555271.png" alt="image-20201011170555271" loading="lazy"></p>
<h3 id="1、缓存穿透（查不到导致）"><a href="#1、缓存穿透（查不到导致）" class="headerlink" title="1、缓存穿透（查不到导致）"></a>1、缓存穿透（查不到导致）</h3><blockquote>
<p>概述</p>
</blockquote>
<p>缓存穿透的概念：用户想要查询一个数据，发现Redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候缓存都没有命中，于是都去请求了持久层数据库，这会给持久层数据库带来很大的压力，这时候就相当于出现了缓存穿透！</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>布隆过滤器</strong></p>
<p>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层进行校验，不符合则丢失，从而避免了对底层存储系统的查询压力。</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011171055323.png" alt="image-20201011171055323" loading="lazy"></p>
<p><strong>缓存空对象</strong></p>
<p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源。</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011171300066.png" alt="image-20201011171300066" loading="lazy"></p>
<p>但是这种方法会存在两个问题：</p>
<ol>
<li>如果空指能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键</li>
<li>即使对控制设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响</li>
</ol>
<h3 id="2、缓存击穿（量太大，缓存过期）"><a href="#2、缓存击穿（量太大，缓存过期）" class="headerlink" title="2、缓存击穿（量太大，缓存过期）"></a>2、缓存击穿（量太大，缓存过期）</h3><p><em>例如微博热搜会导致宕机</em></p>
<blockquote>
<p>概述</p>
</blockquote>
<p>这里需要注意缓存击穿和缓存穿透的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开一个洞。</p>
<p>当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导致数据库瞬间压力过大。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>设置热点数据永不过期</strong></p>
<p>从缓存层面来看，没有设置过期时间，所以不会出现热点key过期后产生的问题。</p>
<p><strong>加互斥锁</strong></p>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011172517422.png" alt="image-20201011172517422" loading="lazy"></p>
<h3 id="3、缓存雪崩"><a href="#3、缓存雪崩" class="headerlink" title="3、缓存雪崩"></a>3、缓存雪崩</h3><blockquote>
<p>概述</p>
</blockquote>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效，Redis宕机！</p>
<p>集中过期倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务器节点宕机，对数据库服务器造成的压力是不可预知的，很可能瞬间就把数据库压垮。</p>
<p><img src="/2020/10/11/Redis%E8%BF%9B%E9%98%B6/image-20201011172704790.png" alt="image-20201011172704790" loading="lazy"></p>
<p>例如双十一：停掉一些服务器不可用（保证高可用性能）</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>redis高可用</strong></p>
<p>这个思想的含义是，既然redis有可能挂掉，那多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建集群。</p>
<p><strong>限流降级（在SpringCloud讲解过）</strong></p>
<p>这个解决方案的思想是，缓存失效后，通过加锁或者队列来控制都数据库写缓存的线程数量。比如对某个key只能一个线程查询数据和写缓存，其他线程等待。</p>
<p><strong>数据预热</strong></p>
<p>书记加热的含义就是在正式部署之前，先把可能的数据预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间，让缓存失效的时间尽量均匀。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">谢谢光临~</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>晓江</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/" title="Redis进阶">https://lxjblog.gitee.io/2020/10/11/Redis%E8%BF%9B%E9%98%B6/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/10/18/Pr%E5%89%AA%E8%BE%91%E8%A7%86%E9%A2%91/" rel="prev" title="Pr剪辑视频"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Pr剪辑视频</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/10/07/%E9%A5%A5%E8%8D%92%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/" rel="next" title="饥荒服务器搭建"><span class="post-nav-text">饥荒服务器搭建</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>可以直接写评论内容喔~</span><br></div><div id="valine-container"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function initValine() {
  const valineConfig = {"enable":true,"appId":"71BKFg13iJQvNsFNLGzHmK67-gzGzoHsz","appKey":"IiQx2mfEEjefvbUfSd66nBHd","placeholder":"留下你的评论呗","avatar":"robohash","pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = window.location.pathname
  new Valine(valineConfig)
}
setTimeout(initValine, 1000)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 晓江</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-08-04T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div><script>let date = new Date();
let today = (date.getMonth() + 1) + "-" + date.getDate()
if ("4-4,9-18".indexOf(today) !== -1) {
  document.documentElement.style.filter = "grayscale(1)";
}</script><div class="aplayer no-destroy" id="aplayer" data-id="5157675042" data-server="netease" data-type="playlist" data-fixed="true" data-theme="#0078E7" data-loop="all" data-order="random" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="1" data-listmaxheight="340px" data-storagename="metingjs"></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>