<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="晓江"><meta name="copyright" content="晓江"><meta name="generator" content="Hexo 5.0.0"><meta name="theme" content="hexo-theme-yun"><title>MybatisPlus 源码 | 云端小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.16/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->const a = 1;
document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><link rel="shortcut icon" type="image/svg+xml" href="/icon.jpg"><link rel="mask-icon" href="/icon.jpg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="云端小站" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"云端小站","version":"0.9.4","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"}};
  </script><meta name="description" content="MybatisPlus 源码">
<meta property="og:type" content="article">
<meta property="og:title" content="MybatisPlus 源码">
<meta property="og:url" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/index.html">
<meta property="og:site_name" content="云端小站">
<meta property="og:description" content="MybatisPlus 源码">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565502098-fdc09b11-fd68-4412-92d6-7fa70e433ec9.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565553864-70fec84b-03bd-4f30-aa70-930300af0376.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565562469-7ef3bdb3-ca03-4818-bd30-c10339cea6a5.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565580781-7c613637-eec4-46b6-8f85-8068e6af6fec.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565635512-19399008-3fdb-498c-a0e1-3d5410fd40cc.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565741849-4b1ee454-72a7-42ad-8fac-25e7d0e64ada.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565865134-4dbf3b71-0198-4d05-b4c5-f687a1c83b81.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565845187-a9fbf1dd-33fe-4481-b8f9-2785adb0e584.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565968274-fce325d1-c3c5-45b5-b4f6-68ce690799f0.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712566832416-d6d0a036-23f1-415c-940c-1b3e5afd0f44.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712566832416-d6d0a036-23f1-415c-940c-1b3e5afd0f44.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567234385-7dae86eb-003f-4e8c-b813-881b816c2dbf.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567477524-b39f2f8f-8429-4c24-8c5a-58904efe50df.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567578548-168cee32-d953-42e2-a898-adc74c5ca678.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567736636-f621d04e-d55d-4e5a-99de-3e1ee8c500fe.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567833164-35f61489-4fb5-4e02-9c83-6ebef756edd1.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568042723-31aada57-9fee-4a66-a3e8-69759ea61f68.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568194347-196d9768-f407-4acc-a02b-e8b58f6e0c09.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568084044-ffd99785-c321-44f3-9841-0204ca6d9fdc.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568311271-8265f85c-f7b5-48f4-ab31-b4b45a2b82f7.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568406703-a5a20c88-4d03-47a7-b1c7-208791c11f7a.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568445396-c5da26d9-7d99-4773-870e-673452f32d66.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570067145-ff077161-8305-4399-8ae9-d866c56bc42f.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570121197-dc896250-72d6-45d5-9e9a-3d84781e6048.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570201710-eff8dfda-19cb-433d-9241-ebb3147d9f39.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569055726-f8aee0cb-b93f-4e4d-8613-05673027ed07.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569738518-9482fb91-868e-405c-bf2a-caca5c0ba58a.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569865616-1999fc7a-0461-4f40-a2da-6802671154bd.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569884988-a9f5605f-5bab-40dc-b96f-5d394f6797b8.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570528579-7e27adbd-38a1-43ca-8218-b7aa3c48a6d7.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712571070304-2e1fb0d4-02a2-42d3-93f6-e16697febe1e.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712571099894-f8902d60-5009-46c4-a5bd-43ca7fe40250.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624741144-bca61d65-797c-4642-b8db-d87724bbb396.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624801223-10db3f75-f2e5-46e9-bbce-5e6019dcf80d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624923574-d49ac13e-3390-42af-a93a-d3a7125eeaaf.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624940499-9d0a7a4c-6a52-4056-b29e-4edf7eaee743.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625029372-1ef3b055-8354-4a0e-919f-2aae4ec370a0.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625050833-616e29c6-b13b-4267-917c-cca541f73b01.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625120177-ecdb6afa-fdff-4479-9519-993a8ef9af32.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625211564-0fffa291-06a7-437c-b811-0c0ddbcf7553.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625276800-f35e8990-5fb8-4644-b6ba-8ec4aae53363.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626113347-f1a843cb-15b3-4d7a-a75b-84a2a4c005a2.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626156990-e7c116b1-72c4-45fc-a63a-e132cfe073c6.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626181966-46686a0f-0991-42a4-9cbe-323a085b7963.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626242809-9ad661df-b333-45cc-acc6-7a2041a5eb60.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626342487-e1ae9872-496b-42b9-ae52-a22af485a54d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626401657-6925d480-78d6-4fe7-a36d-29b56f9c5900.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626454725-d57b6a9a-ad7d-4144-8345-f03a99311d63.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626514303-51093cb7-ab15-4515-934a-464ee3fb37d2.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626543842-50710fd6-19c5-42ad-8190-5e49b1aa1477.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626584731-474b72b7-671b-44d0-b9b4-7fa70479a004.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626639665-495c3144-500d-404b-8788-901983896185.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626686509-6ac46c6d-39a6-473c-b23e-5dd3d108c4ff.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626827094-a4cd5e3b-0d3b-4686-9de6-1b134607640d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712627317654-35ee2d87-f0b5-455a-b6e2-cda79d6da854.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626936366-4c7d1eaf-ccaf-4cd6-a108-52199796bfd3.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712629339727-2ae817b0-7ec6-4d99-aa71-69261c45aefd.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712629458727-84d5b2c2-e945-4374-a8b3-4aeb1c16c59d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366131468-aa257204-ae60-4cd1-b33f-149ec862ad90.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366194392-4dc86aa8-bddb-477b-84b7-566edd199e61.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366288306-3ac9eda1-01c8-4f70-8c1d-834b741e86d8.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366368094-b24f86c4-3d06-4a68-8ffe-cc1b10af9a59.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366446673-7d630f68-1ff9-4438-b2a1-80b1c76be0f5.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366486717-34a3b5ab-1756-40e3-a04e-fb767e0a59fb.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366526639-68d9b14c-f475-4449-8255-7c7eb9746c27.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366571159-0ac60806-a632-4152-ad0a-46df0319eb2b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366641758-b0a66668-bd9a-4b94-b7d8-3da85f7e31ad.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450697755-08d257f3-1769-4eea-9ecb-e3955891c0c5.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720449998033-fd4f11ad-0fcc-4321-8dd5-74cd01474e3a.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450058349-95a264da-e3e7-46b6-8b99-5aaa117b95e5.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450100551-d481d3b7-5d2e-4558-adfc-e8ac836e6126.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450220160-7ce5bf22-a97a-4e0b-9e56-4d3d26999649.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450432757-d607f683-d997-4434-91df-86eb427f07be.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720453772647-67e769f5-27d2-4def-89a7-eaa8e467519d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720453901098-99461cc0-623c-42eb-b415-11249ddd06e2.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720453964519-7cad3acc-f125-44c2-a471-c49c975cd6a4.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454073892-ac1d6abd-d45d-498d-9bf6-beb4fd7f9f41.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454151443-e93ef6b7-7c62-44c9-9b9d-43664953a3d4.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454496516-2cfae111-4958-41c9-bac5-b751fe6f2534.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454506782-6465aa71-cac7-4ea1-8c91-dc4ea97a79a3.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454541765-5fa3f94b-1569-4be8-8e6f-e49eac8847d1.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720533669096-607c4421-e003-490e-a791-a30c278fda0e.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720533777005-674cf766-d8fb-4f7b-9144-7ca7feb7bf68.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534204185-4c682125-a0ad-4b26-81b7-7d985a82986e.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534229222-49aebb95-5632-4c30-a862-74e422e5116f.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534314477-e2467cac-e767-42b4-873c-7c4b84ca034f.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534358214-7b3c5d8f-473d-42f4-97b7-622d749528df.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534432287-fe0a7793-5c13-41d1-b127-2ec99553a5ab.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534558971-81d774f4-00fe-4f35-835c-edc33f071d40.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534705031-d6eea80f-70f2-4640-a7ae-d6b280668cd3.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534840722-65afc296-9972-47d5-b0e3-77cf0b0184a5.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535024858-a6c565d3-4fb2-4640-ac39-81f62c68786c.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535036269-d1c8fbf3-c398-41ff-8650-45abf15d9cb6.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535267213-268a652b-a8e7-4b8a-8be6-004f0aaf5730.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535438868-19a46b90-ff5b-4b81-80cb-62a4bf36f1bf.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535881406-d4b3866b-7ab3-4cab-a8af-0c352379802d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536813346-e81eeace-e569-486d-8e33-008da0b22f3d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536843820-670ec76e-5688-4be7-a216-8b35199299dc.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536907835-0c61c31b-54a8-43e3-b5cd-ca90fddb01fe.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537060165-d2710572-0c7c-47f3-b744-39326fefb10d.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536123931-7642f05a-5e09-4921-98c5-42d58244bbdc.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537382330-24bbd53a-7924-4fed-9eec-322d20c8117e.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537548761-2c7ec55e-ad0d-475f-9747-f5b408745fbe.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537597408-3536902b-5597-413c-9628-81f143b0cdfc.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675643528-bb7251a5-4954-4fd0-990b-1daebbfce52a.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675759296-3b0e96fa-5656-4aba-a26d-90de46a02652.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675773065-900b894e-0cfc-47ec-aac2-8a0d304c7b12.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501052411-a6965ab0-c777-4d61-9b49-119140eb3286.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501106011-661935d2-522e-4a83-a4ac-6088cb70ffc8.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501130205-7cf79854-d980-4db1-a2ef-6e804f74ed89.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501291620-051ef07c-aaf3-4fc9-be05-f17974176e8f.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501357183-b5ff2fe5-445c-45b4-ba25-e4ff70fced0b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501528356-bdd8e0f4-f864-41ca-9a50-38ae98966a6b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501611940-c7578f25-cbaa-44cd-bda5-d85ca552033b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720624879769-5108cc05-ca7f-427b-8379-f40539d0fd36.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625698705-ca341f49-481b-41a4-bf32-fab19c8cc5a7.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625760614-aa73e052-eb64-49d6-888a-cd43521cffc1.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625855088-69057039-1457-4aaa-a171-959a7b52d5c0.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625910882-5ff18ad1-9e58-481b-913f-38ea69bb9391.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625956481-f65334db-c08d-4268-aa8c-dbc43712f04c.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626692585-8dbf3132-e5b1-4294-a904-742967d96a31.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626778060-0d9b9005-2d26-4d69-b713-f522b150d7c4.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720627101392-18ffbeb2-e3f8-4cef-9b65-c9e9883a6252.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626108687-a6708956-ee7e-4ced-a09c-7a731d6a2254.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626245507-ec113717-42f7-4ed5-9dd1-6f1f04745e6b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626472115-54c9436d-905c-430a-8631-0a5cedc729a0.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626539117-9e14fc68-123a-4927-98e4-676f9b318e63.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720673891566-89af2487-6ba3-4120-9da9-58cfb9c3edbd.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674000991-e7041f02-dc1d-4f35-8cb0-4920263b3c53.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674105197-028ba40f-224d-4cd1-9eee-dd3e47168d2b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674352825-09201b1f-eea2-4296-88a5-b4f56fd3dc67.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674468034-d97d492f-0327-463b-ab11-ad9447b0eb9b.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674642515-baba32d4-b57a-4ed1-9bc7-42fe4e0e41d7.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674871348-5b430c55-5a8f-45e2-bd80-a45dfbce4fd9.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674922166-061bb772-fe95-4888-9401-5fb85e36e417.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674980291-9294a95e-5653-400f-99b9-1259c28cea40.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675029147-a75455c7-cf3e-4314-8cd4-3123d9ac9a2e.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675048047-1c4cd731-9806-43ff-99af-04183e8bf211.png">
<meta property="og:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675061337-477447b0-2cd9-4c9e-9d4d-c0c09ee20be6.png">
<meta property="article:published_time" content="2024-07-12T14:26:10.000Z">
<meta property="article:modified_time" content="2024-08-04T15:53:48.694Z">
<meta property="article:author" content="晓江">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565502098-fdc09b11-fd68-4412-92d6-7fa70e433ec9.png"><script src="/js/ui/mode.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script defer src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="晓江"><img width="96" loading="lazy" src="/icon.jpg" alt="晓江"></a><div class="site-author-name"><a href="/about/">晓江</a></div><a class="site-name" href="/about/site.html">云端小站</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">70</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">18</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">57</span></a></div><a class="site-state-item hty-icon-button" href="https://lxjblog.gitee.io/myblog" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/wechat/" title="微信" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1256240778&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/Xiaojiang-l" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/playlist?id=5157675042" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:1256240778@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">自动配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapper-%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-text">Mapper 创建过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mapper-%E6%89%AB%E6%8F%8F%E6%B3%A8%E5%86%8C%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">mapper 扫描注册的两种方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mapper-%E6%B3%A8%E5%86%8C%E8%BF%87%E7%A8%8B"><span class="toc-text">Mapper 注册过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MybatisConfiguration-%E6%B7%BB%E5%8A%A0-mapper-%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-text">MybatisConfiguration 添加 mapper 的过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MybatisConfiguration-%E8%8E%B7%E5%8F%96-mapper-%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-text">MybatisConfiguration 获取 mapper 的过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B0%8F%E7%BB%93"><span class="toc-text">创建小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis-%E7%BC%93%E5%AD%98"><span class="toc-text">Mybatis 缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">二级缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-text">二级缓存配置参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E6%B8%85%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-text">二级缓存清除方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98-key-%E7%9A%84%E8%AE%A1%E7%AE%97"><span class="toc-text">缓存 key 的计算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mybatis-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">Mybatis 拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%95%88%E8%BF%87%E7%A8%8B"><span class="toc-text">生效过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE"><span class="toc-text">拦截器链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatisPlus-%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">MyBatisPlus 拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">分页查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-text">面试题</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="晓江"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="云端小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MybatisPlus 源码</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2024-07-12 22:26:10" itemprop="dateCreated datePublished" datetime="2024-07-12T22:26:10+08:00">2024-07-12</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2024-08-04 23:53:48" itemprop="dateModified" datetime="2024-08-04T23:53:48+08:00">2024-08-04</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/%E5%90%8E%E7%AB%AF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">后端</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/java/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">java</span></a></span></div><div class="post-author"><div class="author-avatar"><img src="https://xiaojiang-l.github.io/icon.jpg"></div><span class="author-name">晓江</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><p>对应 MybatisPlusAutoConfiguration 配置类</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><ol>
<li>创建 SqlSessionFactory 类型的 bean，加载各类插件（sql注入、id生成等）</li>
</ol>
<p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565502098-fdc09b11-fd68-4412-92d6-7fa70e433ec9.png" alt="image.png" loading="lazy"></p>
<ol start="2">
<li>创建 SqlSessionTemplate 类型的 bean，实现 sqlSeesion 接口的 crud 方法，这部分接口每次调用都会使用 SqlSessionFactory 的 openSession() 方法创建 sqlSession，所以真正的方法体在  DefaultSqlSession 类中</li>
</ol>
<p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565553864-70fec84b-03bd-4f30-aa70-930300af0376.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565562469-7ef3bdb3-ca03-4818-bd30-c10339cea6a5.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565580781-7c613637-eec4-46b6-8f85-8068e6af6fec.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565635512-19399008-3fdb-498c-a0e1-3d5410fd40cc.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565741849-4b1ee454-72a7-42ad-8fac-25e7d0e64ada.png" alt="image.png" loading="lazy"></p>
<ol start="3">
<li>创建默认的 AutoConfiguredMapperScannerRegistrar 扫描类，默认扫描启动类所属包路径下的带有 @Mapper 注解的文件作为 bean（如果配置了 @MappeScan 注解，则 @Mapper 注解失效）</li>
</ol>
<p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565865134-4dbf3b71-0198-4d05-b4c5-f687a1c83b81.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565845187-a9fbf1dd-33fe-4481-b8f9-2785adb0e584.png" alt="image.png" loading="lazy"></p>
<h2 id="Mapper-创建过程"><a href="#Mapper-创建过程" class="headerlink" title="Mapper 创建过程"></a>Mapper 创建过程</h2><p>在日常使用中，我们一般直接创建一个 mapper 接口，继承 BaseMappe 接口之后，便拥有了 curd 的功能，可以直接在 service 中依赖注入这个 bean 使用<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712565968274-fce325d1-c3c5-45b5-b4f6-68ce690799f0.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712566832416-d6d0a036-23f1-415c-940c-1b3e5afd0f44.png" alt="image.png" loading="lazy"><br>但是默认情况下，spring 扫描注册 bean 的时候是会自动排除掉接口类型的，而这些 mapper 作为接口，且没有方法实现体，那么最终被注册到 spring 容器中的 bean 就应该是 mapper 的代理对象</p>
<h3 id="mapper-扫描注册的两种方式"><a href="#mapper-扫描注册的两种方式" class="headerlink" title="mapper 扫描注册的两种方式"></a>mapper 扫描注册的两种方式</h3><ol>
<li>直接在 mapper 上添加 @Mapper 注解</li>
</ol>
<p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712566832416-d6d0a036-23f1-415c-940c-1b3e5afd0f44.png" alt="image.png" loading="lazy"></p>
<ol start="2">
<li>在配置类上添加 @MapperScan 注解，指定 mapper 路径，当这里指定之后，其他路径下使用 @Mapper 注解将会<strong>失效</strong></li>
</ol>
<p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567234385-7dae86eb-003f-4e8c-b813-881b816c2dbf.png" alt="image.png" loading="lazy"></p>
<h3 id="Mapper-注册过程"><a href="#Mapper-注册过程" class="headerlink" title="Mapper 注册过程"></a>Mapper 注册过程</h3><p>以 @MapperScan注解为例说明，当我们使用这个注解指定扫描路径之后，会将 MapperScannerRegistrar 注册为 bean（从而使得自动的扫描 @Mapper 注解失效），并调用对用方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567477524-b39f2f8f-8429-4c24-8c5a-58904efe50df.png" alt="image.png" loading="lazy"><br>MapperScannerRegistrar 类会加载 @MapperScan 注解中指定的路径等信息<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567578548-168cee32-d953-42e2-a898-adc74c5ca678.png" alt="image.png" loading="lazy"><br>这里先通过 BeanDefinitionBuilder 创建了一个 MapperScannerConfigurer 类型的 bean<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567736636-f621d04e-d55d-4e5a-99de-3e1ee8c500fe.png" alt="image.png" loading="lazy"><br>而 MapperScannerConfigurer 这个 bean 在创建之前会调用其 postProcessBeanDefinitionRegistry 方法，并自定义了一个扫描器，用于扫描 mapper 并进行处理（这部分可以参考：<a href="https://lxjblog.gitee.io/2023/08/24/spring%E6%BA%90%E7%A0%81/?t=1712563878288">https://lxjblog.gitee.io/2023/08/24/spring%E6%BA%90%E7%A0%81/?t=1712563878288</a>）<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712567833164-35f61489-4fb5-4e02-9c83-6ebef756edd1.png" alt="image.png" loading="lazy"><br>上方调用了 ClassPathMapperScanner 父类的 scan() 方法，不过还是会调用自身的 doScan() 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568042723-31aada57-9fee-4a66-a3e8-69759ea61f68.png" alt="image.png" loading="lazy"><br>并且 ClassPathMapperScanner 重写的判断条件，这里只需要扫描独立的接口类型（不是静态内部类）<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568194347-196d9768-f407-4acc-a02b-e8b58f6e0c09.png" alt="image.png" loading="lazy"><br>先调用父类（也就是扫描器 ClassPathBeanDefinitionScanner）的 doScan() 方法，用于将指定路径的文件扫描为 bean<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568084044-ffd99785-c321-44f3-9841-0204ca6d9fdc.png" alt="image.png" loading="lazy"><br>获取扫描到的结果，取其对应的 beanDefinition，因为这个时候扫描的都是接口本身，所以需要使用 setBeanClass() 方法指定其实现类，而 getConstructorArgumentValues() 用于指定实现类构造方法的参数<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568311271-8265f85c-f7b5-48f4-ab31-b4b45a2b82f7.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568406703-a5a20c88-4d03-47a7-b1c7-208791c11f7a.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712568445396-c5da26d9-7d99-4773-870e-673452f32d66.png" alt="image.png" loading="lazy"><br>同时 MapperFactoryBean 继承了 DaoSupport，所以会调用 checkDaoConfig() 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570067145-ff077161-8305-4399-8ae9-d866c56bc42f.png" alt="image.png" loading="lazy"><br>所以在这里会将 mapper 的接口类型添加到 configuration 中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570121197-dc896250-72d6-45d5-9e9a-3d84781e6048.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570201710-eff8dfda-19cb-433d-9241-ebb3147d9f39.png" alt="image.png" loading="lazy"><br>最后通过 MapperFactoryBean 的 getObject() 方法获取实例<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569055726-f8aee0cb-b93f-4e4d-8613-05673027ed07.png" alt="image.png" loading="lazy"><br>而这个 mapper 会由 MybatisConfiguration 进行获取，也就是获取到上方添加的 mapper 内容<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569738518-9482fb91-868e-405c-bf2a-caca5c0ba58a.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569865616-1999fc7a-0461-4f40-a2da-6802671154bd.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712569884988-a9f5605f-5bab-40dc-b96f-5d394f6797b8.png" alt="image.png" loading="lazy"><br>最终生成 mapper 的代理类对象<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712570528579-7e27adbd-38a1-43ca-8218-b7aa3c48a6d7.png" alt="image.png" loading="lazy"></p>
<h3 id="MybatisConfiguration-添加-mapper-的过程"><a href="#MybatisConfiguration-添加-mapper-的过程" class="headerlink" title="MybatisConfiguration 添加 mapper 的过程"></a>MybatisConfiguration 添加 mapper 的过程</h3><p>这是由 mybatis-plus 创建的一个配置类，继承于 Configuration，但是添加了 mybatis-plus 的一些特性，只需要在自动配置类 MybatisPlusAutoConfiguration 中创建 SqlSessionFactory 的时候指定 configuration 为 MybatisConfiguration 类型即可<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712571070304-2e1fb0d4-02a2-42d3-93f6-e16697febe1e.png" alt="image.png" loading="lazy"><br>在添加 mapper 的时候，会先将代理类添加到 knownMappers 这个 map 中，避免重复添加，然后调用 parser.parse() 方法，用于生成对应的 sql 语句<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712571099894-f8902d60-5009-46c4-a5bd-43ca7fe40250.png" alt="image.png" loading="lazy"><br>遍历 mapper 的所有方法，并生成对应的 sql 语句，通过 parseStatement() 和 parserInjector() 方法将 sql 语句添加到 configuration 中</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    String resource <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>configuration<span class="token punctuation">.</span><span class="token function">isResourceLoaded</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment" spellcheck="true">// 加载 xml 文件</span>
        <span class="token function">loadXmlResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">addLoadedResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String mapperName <span class="token operator">=</span> type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        assistant<span class="token punctuation">.</span><span class="token function">setCurrentNamespace</span><span class="token punctuation">(</span>mapperName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 是否配置二级缓存</span>
        <span class="token function">parseCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">parseCacheRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        InterceptorIgnoreHelper<span class="token punctuation">.</span>InterceptorIgnoreCache cache <span class="token operator">=</span> InterceptorIgnoreHelper<span class="token punctuation">.</span><span class="token function">initSqlParserInfoCache</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 遍历当前 mapper 的所有方法</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>Method method <span class="token operator">:</span> type<span class="token punctuation">.</span>ge    <span class="token function">tMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canHaveStatement</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
            <span class="token comment" spellcheck="true">// 解析方法上的注解内容</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getAnnotationWrapper</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> Select<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> SelectProvider<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">&amp;&amp;</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span>ResultMap<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                <span class="token function">parseResultMap</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
            <span class="token keyword">try</span> <span class="token punctuation">{</span> 
                InterceptorIgnoreHelper<span class="token punctuation">.</span><span class="token function">initSqlParserInfoCache</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> mapperName<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">// 解析生成 sql 语句，并添加到 configuration 中</span>
                <span class="token function">parseStatement</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncompleteElementException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                configuration<span class="token punctuation">.</span><span class="token function">addIncompleteMethod</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MybatisMethodResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 

        <span class="token comment" spellcheck="true">// 获取 sql 注入器内容（mybatis-plus 中的 BaseMapper 对应的 crud 实现）</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> 
            <span class="token keyword">if</span> <span class="token punctuation">(</span>GlobalConfigUtils<span class="token punctuation">.</span><span class="token function">isSupperMapperChildren</span><span class="token punctuation">(</span>configuration<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 

                <span class="token comment" spellcheck="true">// 解析生成 sql 语句，并添加到 configuration 中</span>
                <span class="token function">parserInjector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span>  <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncompleteElementException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            configuration<span class="token punctuation">.</span><span class="token function">addIncompleteMethod</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InjectorResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
    <span class="token function">parsePendingMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> </code></pre>
<p>parseStatement() 方法用于获取 mapper 方法上的注解等内容解析为 sql 语句，通过调用 assistant.addMappedStatement() 方法将 sql 添加到 mappedStatements 这个 map 中，以 类名+方法名 作为 key，sql 作为 value<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624741144-bca61d65-797c-4642-b8db-d87724bbb396.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624801223-10db3f75-f2e5-46e9-bbce-5e6019dcf80d.png" alt="image.png" loading="lazy"><br>而在 parserInjector() 方法中，则是获取 sqlInjector 注入器<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624923574-d49ac13e-3390-42af-a93a-d3a7125eeaaf.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712624940499-9d0a7a4c-6a52-4056-b29e-4edf7eaee743.png" alt="image.png" loading="lazy"><br>获取 BaseMapper 中默认的方法进行注入<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625029372-1ef3b055-8354-4a0e-919f-2aae4ec370a0.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625050833-616e29c6-b13b-4267-917c-cca541f73b01.png" alt="image.png" loading="lazy"><br>一次调用 Insert 等类的 inject 方法，生成 sql 语句并添加到 configuration 中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625120177-ecdb6afa-fdff-4479-9519-993a8ef9af32.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625211564-0fffa291-06a7-437c-b811-0c0ddbcf7553.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712625276800-f35e8990-5fb8-4644-b6ba-8ec4aae53363.png" alt="image.png" loading="lazy"></p>
<h3 id="MybatisConfiguration-获取-mapper-的过程"><a href="#MybatisConfiguration-获取-mapper-的过程" class="headerlink" title="MybatisConfiguration 获取 mapper 的过程"></a>MybatisConfiguration 获取 mapper 的过程</h3><p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626113347-f1a843cb-15b3-4d7a-a75b-84a2a4c005a2.png" alt="image.png" loading="lazy"><br>创建通过代理对象创建实例<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626156990-e7c116b1-72c4-45fc-a63a-e132cfe073c6.png" alt="image.png" loading="lazy"><br>实际上就是创建了一个 MybatisMapperProxy** **类型的代理对象<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626181966-46686a0f-0991-42a4-9cbe-323a085b7963.png" alt="image.png" loading="lazy"><br>所以每次调用 mapper 的方法的时候，就会经过 MybatisMapperProxy 代理对象的 invoke() 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626242809-9ad661df-b333-45cc-acc6-7a2041a5eb60.png" alt="image.png" loading="lazy"><br>方法调用的时候都会先从缓存中取结果，没有则查询数据库<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626342487-e1ae9872-496b-42b9-ae52-a22af485a54d.png" alt="image.png" loading="lazy"><br>而 MybatisMapperMethod 类的 invoke() 方法是调用 MybatisMapperMethod 类的 execute() 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626401657-6925d480-78d6-4fe7-a36d-29b56f9c5900.png" alt="image.png" loading="lazy"><br>这里就会去判断方法的操作类型<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626454725-d57b6a9a-ad7d-4144-8345-f03a99311d63.png" alt="image.png" loading="lazy"><br>例如查询列表的时候就会调用 executeForMany() 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626514303-51093cb7-ab15-4515-934a-464ee3fb37d2.png" alt="image.png" loading="lazy"><br>这时候就会使用 sqlSession 进行数据库操作<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626543842-50710fd6-19c5-42ad-8190-5e49b1aa1477.png" alt="image.png" loading="lazy"><br>而当前容器中注册的是 SqlSessionTemplate 类型的，所以会调用 sqlSessionProxy 代理类的方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626584731-474b72b7-671b-44d0-b9b4-7fa70479a004.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626639665-495c3144-500d-404b-8788-901983896185.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626686509-6ac46c6d-39a6-473c-b23e-5dd3d108c4ff.png" alt="image.png" loading="lazy"><br>而 getSqlSession() 方法获取到的是 DefaultSqlSession 类型的 sqlSession<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626827094-a4cd5e3b-0d3b-4686-9de6-1b134607640d.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712627317654-35ee2d87-f0b5-455a-b6e2-cda79d6da854.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712626936366-4c7d1eaf-ccaf-4cd6-a108-52199796bfd3.png" alt="image.png" loading="lazy"><br>所以在这里的 mapper 就可以获取到上面添加的 sql 表达式了<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712629339727-2ae817b0-7ec6-4d99-aa71-69261c45aefd.png" alt="image.png" loading="lazy"><br>通过 getBoundSql() 方法就可以获取 sql 语句了<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1712629458727-84d5b2c2-e945-4374-a8b3-4aeb1c16c59d.png" alt="image.png" loading="lazy"></p>
<h3 id="创建小结"><a href="#创建小结" class="headerlink" title="创建小结"></a>创建小结</h3><p>1、Mapper 在注册过程中会先创建 MapperScannerConfigurer 这个 bean<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366131468-aa257204-ae60-4cd1-b33f-149ec862ad90.png" alt="image.png" loading="lazy"><br>2、这个 bean 自定义扫描器，也可以配置扫描规则，mybatis 配置只扫描独立的接口<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366194392-4dc86aa8-bddb-477b-84b7-566edd199e61.png" alt="image.png" loading="lazy"><br>3、ClassPathMapperScanner 将扫描出来的 GenericBeanDefinition 设置实现类为 MapperFactoryBean<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366288306-3ac9eda1-01c8-4f70-8c1d-834b741e86d8.png" alt="image.png" loading="lazy"><br>4、所以每个扫描出来的 mapper 是从 MybatisConfiguration 类的 mybatisMapperRegistry 中获取的<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366368094-b24f86c4-3d06-4a68-8ffe-cc1b10af9a59.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366446673-7d630f68-1ff9-4438-b2a1-80b1c76be0f5.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366486717-34a3b5ab-1756-40e3-a04e-fb767e0a59fb.png" alt="image.png" loading="lazy"><br>5、所以实际的代理对象是这个 MybatisMapperProxy<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366526639-68d9b14c-f475-4449-8255-7c7eb9746c27.png" alt="image.png" loading="lazy"><br>6、所以每次调用 mapper 的方法的时候，都会执行 MybatisMapperMethod 的 execute 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366571159-0ac60806-a632-4152-ad0a-46df0319eb2b.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720366641758-b0a66668-bd9a-4b94-b7d8-3da85f7e31ad.png" alt="image.png" loading="lazy"></p>
<h2 id="Mybatis-缓存"><a href="#Mybatis-缓存" class="headerlink" title="Mybatis 缓存"></a>Mybatis 缓存</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d559dfd06589">Mybatis之一二级缓存和拦截器</a></p>
<h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><p>注意：mybatis 中使用的是 sqlSession 代理对象进行查询操作，所以调用任何查询方法之前都会经历下方的代理，先获取 sqlSession，所以如果没开启事务的话，你的每次查询都是使用不同的 DefaultSqlSession 进行查询，所以不会有一级缓存<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450697755-08d257f3-1769-4eea-9ecb-e3955891c0c5.png" alt="image.png" loading="lazy"><br><strong>接下来是方法试探</strong><br>1、直接查看 DefaultSqlSession 的 selectList 查询方法，缓存是在 executor 中执行的<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720449998033-fd4f11ad-0fcc-4321-8dd5-74cd01474e3a.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450058349-95a264da-e3e7-46b6-8b99-5aaa117b95e5.png" alt="image.png" loading="lazy"><br>2、在 MybatisCachingExecutor 中执行 query 操作，key 中包含如下信息<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450100551-d481d3b7-5d2e-4558-adfc-e8ac836e6126.png" alt="image.png" loading="lazy"><br>3、如果存在缓存，则直接返回结果，不存在则查询数据库<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450220160-7ce5bf22-a97a-4e0b-9e56-4d3d26999649.png" alt="image.png" loading="lazy"><br>4、其中还会判断是否需要分页 pageOptional，返回分页对象<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720450432757-d607f683-d997-4434-91df-86eb427f07be.png" alt="image.png" loading="lazy"><br>重点来啦<br>开启事务进行测试：<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720453772647-67e769f5-27d2-4def-89a7-eaa8e467519d.png" alt="image.png" loading="lazy"><br>结果发现这个 cache 一直为 null，所以问题来啦，mybatis 的<strong>一级缓存</strong>不是在这里实现的，盲猜这里是实现二级缓存的，因为这个 cache 是存在在 MappedStatement 中的，应该所有线程都可以访问<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720453901098-99461cc0-623c-42eb-b415-11249ddd06e2.png" alt="image.png" loading="lazy"><br>但是日志中确实只查询了一次数据库<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720453964519-7cad3acc-f125-44c2-a471-c49c975cd6a4.png" alt="image.png" loading="lazy"></p>
<p><strong>所以实际的缓存是在 BaseExecutor 中实现的</strong><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454073892-ac1d6abd-d45d-498d-9bf6-beb4fd7f9f41.png" alt="image.png" loading="lazy"><br>当 localCache 缓存中不存在时，则调用 queryFromDatabase 方法进行数据库查询并将结果存放到缓存中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454151443-e93ef6b7-7c62-44c9-9b9d-43664953a3d4.png" alt="image.png" loading="lazy"><br>并且当 MappedStatement 的 flushCacheRequired 为 true 时则清空缓存<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454496516-2cfae111-4958-41c9-bac5-b751fe6f2534.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454506782-6465aa71-cac7-4ea1-8c91-dc4ea97a79a3.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720454541765-5fa3f94b-1569-4be8-8e6f-e49eac8847d1.png" alt="image.png" loading="lazy"></p>
<h3 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h3><p>Mybatis 的二级缓存是默认开启的（也可能是跟版本有关），同样也可以在 xml 文件中使用 <cache> 标签进行定义，在所需要缓存的查询接口配置开启</cache></p>
<pre class=" language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span>
<span class="token doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.yihaomen.mybatis.dao.StudentMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--开启本mapper的namespace下的二级缓存--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">eviction</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>LRU<span class="token punctuation">"</span></span> <span class="token attr-name">flushInterval</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100000<span class="token punctuation">"</span></span> <span class="token attr-name">readOnly</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

    <span class="token comment" spellcheck="true">&lt;!--可以通过设置useCache来规定这个sql是否开启缓存，ture是开启，false是关闭--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectAllStudents<span class="token punctuation">"</span></span> <span class="token attr-name">useCache</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        SELECT id, name, age FROM student
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span></code></pre>
<p><strong>不过主要还是讲 springboot 项目中的应用：</strong><br>1、配置开启二级缓存（默认开启），这里也可以不配置，除非是要关闭二级缓存</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">cache-enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
<p><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720533669096-607c4421-e003-490e-a791-a30c278fda0e.png" alt="image.png" loading="lazy"><br>这个配置影响的是生成的 sqlsession 中对应的执行 executor 的类型，开启缓存后使用 MybatisCachingExecutor 执行器进行 sql 操作<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720533777005-674cf766-d8fb-4f7b-9144-7ca7feb7bf68.png" alt="image.png" loading="lazy"><br>2、在 Mapper 接口上添加 @CacheNamespace 注解，同时实体对象需要实现序列化接口，因为二级缓存数据存储介质多种多样，不一定只存在内存中，有可能存在硬盘中。序列化作用参考：<a target="_blank" rel="noopener" href="https://www.yuque.com/xiaojiang-wrww2/fbkel6/aefnobtp6905cg8d?view=doc_embed&inner=jKz9u">知识点</a></p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token annotation punctuation">@CacheNamespace</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">StudentSMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token operator">&lt;</span>Students<span class="token operator">></span> <span class="token punctuation">{</span> 
<span class="token punctuation">}</span> </code></pre>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Students</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span> 
    <span class="token annotation punctuation">@TableId</span>
    <span class="token keyword">private</span> Integer id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> LocalDateTime createTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span> </code></pre>
<p><strong>接下来是二级缓存生效过程：</strong><br>1、查看创建 Mapper 的过程<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534204185-4c682125-a0ad-4b26-81b7-7d985a82986e.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534229222-49aebb95-5632-4c30-a862-74e422e5116f.png" alt="image.png" loading="lazy"><br>直接看到 parseCache() 方法这里<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534314477-e2467cac-e767-42b4-873c-7c4b84ca034f.png" alt="image.png" loading="lazy"><br>2、如果当前的 Mapper 接口上添加 @CacheNamespace 注解，则会创建对应 mapper 接口的缓存，相当于这个缓存是针对这一整个 Mapper 接口的<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534358214-7b3c5d8f-473d-42f4-97b7-622d749528df.png" alt="image.png" loading="lazy"><br>3、useNewCache 方法中，会创建当前 mapper 的缓存，并应用注解上的参数，设置 currentCache 为这个缓存<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534432287-fe0a7793-5c13-41d1-b127-2ec99553a5ab.png" alt="image.png" loading="lazy"><br>4、而在后续的 addMappedStatement 方法中，在创建 mapper 每个方法的 statement 时，都会传入这个 cache<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534558971-81d774f4-00fe-4f35-835c-edc33f071d40.png" alt="image.png" loading="lazy"><br><strong>然后就是二级缓存的存取啦：</strong><br>1、也就是在一级缓存中猜测的位置，在 MybatisCachingExecutor 类的 query 方法会先获取 MappedStatement 的 cache（在上面添加进去的）<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534705031-d6eea80f-70f2-4640-a7ae-d6b280668cd3.png" alt="image.png" loading="lazy"><br>2、接下来就会发现二级缓存中没有数据，需要进行数据库查询，并把结果 result 存到缓存中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720534840722-65afc296-9972-47d5-b0e3-77cf0b0184a5.png" alt="image.png" loading="lazy"><br>3、但是实际的缓存是存放在 PerpetualCache（永久缓存） 类的 map 中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535024858-a6c565d3-4fb2-4640-ac39-81f62c68786c.png" alt="image.png" loading="lazy"><br>使用 computeIfAbsent 方法时，会把 key 作为参数参入 lambda 表达式中，所以 TransactionalCache 中的 delegate 是注解生成的 cache<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535036269-d1c8fbf3-c398-41ff-8650-45abf15d9cb6.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535267213-268a652b-a8e7-4b8a-8be6-004f0aaf5730.png" alt="image.png" loading="lazy"><br>4、虽然名字叫永久缓存，但我好像也看不出怎么是永久的~重启项目还是会清空缓存<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535438868-19a46b90-ff5b-4b81-80cb-62a4bf36f1bf.png" alt="image.png" loading="lazy"></p>
<h3 id="二级缓存配置参数"><a href="#二级缓存配置参数" class="headerlink" title="二级缓存配置参数"></a>二级缓存配置参数</h3><p>1、查看 @CacheNamespace 注解的内容，原来 PerpetualCache 缓存是默认配置，缓存大小默认为 1024</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>ElementType<span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> @<span class="token keyword">interface</span> <span class="token class-name">CacheNamespace</span> <span class="token punctuation">{</span> 

  <span class="token comment" spellcheck="true">/**
   * 要使用的缓存实现类型
   */</span>
  Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Cache</span><span class="token operator">></span> <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> PerpetualCache<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 要使用的缓存逐出实现类型（相当于修饰器，在实现类之前调用）
   * LruCache 用于维持缓存数量
   */</span>
  Class<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Cache</span><span class="token operator">></span> <span class="token function">eviction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> LruCache<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 刷新间隔
   */</span>
  <span class="token keyword">long</span> <span class="token function">flushInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 缓存大小
   */</span>
  <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">1024</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 是否使用读/写缓存
   */</span>
  <span class="token keyword">boolean</span> <span class="token function">readWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 是否在请求时阻止缓存
   */</span>
  <span class="token keyword">boolean</span> <span class="token function">blocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">/**
   * 属性值
   */</span>
  Property<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token punctuation">;</span>

<span class="token punctuation">}</span> </code></pre>
<p>2、这些配置在创建 cache 的时候有用到，所以我们可以指定任何 cache 实现类作为缓存实现类<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720535881406-d4b3866b-7ab3-4cab-a8af-0c352379802d.png" alt="image.png" loading="lazy"><br>3、查看 Decorator<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536813346-e81eeace-e569-486d-8e33-008da0b22f3d.png" alt="image.png" loading="lazy"><br>调用 addDecorator 方法的时候会将 Cache 实现类添加到 builder 的 List 集合中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536843820-670ec76e-5688-4be7-a216-8b35199299dc.png" alt="image.png" loading="lazy"><br>在调用 build 方法的时候就会遍历这个 decorators 集合，将当前 cache 作为参数构造新的 cache 实现对象（相当于在外面包了一层），最终返回的是最外层的 cache 对象<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536907835-0c61c31b-54a8-43e3-b5cd-ca90fddb01fe.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537060165-d2710572-0c7c-47f3-b744-39326fefb10d.png" alt="image.png" loading="lazy"><br>3、不过发现这里并没有提供基于 redis 的 Cache 实现类，不过我们也可以自己实现一个 redis 缓存，并配置到注解中就可以啦<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720536123931-7642f05a-5e09-4921-98c5-42d58244bbdc.png" alt="image.png" loading="lazy"><br>4、查看默认配置中的 LruCache 缓存实现类，这个类中也创建了一个 map 用于存放 key，不同的是这个用的是 linkedHashMap，保存有序的数据，并重写了 removeEldestEntry() 方法，当容量超过设置的 size 时就会移除最旧的 key<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537382330-24bbd53a-7924-4fed-9eec-322d20c8117e.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537548761-2c7ec55e-ad0d-475f-9747-f5b408745fbe.png" alt="image.png" loading="lazy"><br>所以每次添加缓存的时候，都会去检查 eldestKey 是否不为空，不为空则需要删除最旧的缓存数据啦<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720537597408-3536902b-5597-413c-9628-81f143b0cdfc.png" alt="image.png" loading="lazy"></p>
<h3 id="二级缓存清除方法"><a href="#二级缓存清除方法" class="headerlink" title="二级缓存清除方法"></a>二级缓存清除方法</h3><p>1、在创建每个 mapper 方法的 statement 的时候，都会传入同一个 cache 对象，以及是否刷新缓存（如果这个 statement 不是 select 类型，则它每次调用都会刷新缓存）<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675643528-bb7251a5-4954-4fd0-990b-1daebbfce52a.png" alt="image.png" loading="lazy"><br>2、所以当调用 update 类型的 statement 方法的时候就会刷新缓存啦，这里刷新的是整个 mapper 接口的缓存，而不只是这个方法的<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675759296-3b0e96fa-5656-4aba-a26d-90de46a02652.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675773065-900b894e-0cfc-47ec-aac2-8a0d304c7b12.png" alt="image.png" loading="lazy"><br>所以在同一个 mapper 中，只要调用了其中的一个 update 类型的方法，都会刷新掉整个 namespace 命名空间（接口）的缓存</p>
<h3 id="缓存-key-的计算"><a href="#缓存-key-的计算" class="headerlink" title="缓存 key 的计算"></a>缓存 key 的计算</h3><p>1、通过 mybatis 的源码可以看出 key 的类型为 CacheKey<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501052411-a6965ab0-c777-4d61-9b49-119140eb3286.png" alt="image.png" loading="lazy"><br>2、而创建 key 的过程如下，通过创建一个 CacheKey 类型的对象，并不断调用对应的 update 方法，往 key 中添加内容<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501106011-661935d2-522e-4a83-a4ac-6088cb70ffc8.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501130205-7cf79854-d980-4db1-a2ef-6e804f74ed89.png" alt="image.png" loading="lazy"><br>3、计算 CacheKey 的 hashCode 值<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501291620-051ef07c-aaf3-4fc9-be05-f17974176e8f.png" alt="image.png" loading="lazy"><br>4、重写 hashCode 方法，方便 hashMap 对该 key 进行存取<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501357183-b5ff2fe5-445c-45b4-ba25-e4ff70fced0b.png" alt="image.png" loading="lazy"><br>5、而在一级缓存中是使用  PerpetualCache 类型作为 Cache 的<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501528356-bdd8e0f4-f864-41ca-9a50-38ae98966a6b.png" alt="image.png" loading="lazy"><br>6、缓存内容的存取都是通过其内部的 HashMap 来实现的，这个 Map 似乎也没有限制大小<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720501611940-c7578f25-cbaa-44cd-bda5-d85ca552033b.png" alt="image.png" loading="lazy"></p>
<h2 id="Mybatis-拦截器"><a href="#Mybatis-拦截器" class="headerlink" title="Mybatis 拦截器"></a>Mybatis 拦截器</h2><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>1、实现 Interceptor 接口，添加 @Intercepts 注解 和 @Signature 注解指定拦截的执行器和方法，并添加 @Component 注册为 bean</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Intercepts</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> 
        <span class="token comment" spellcheck="true">// 指定拦截的类和方法（参数）</span>
         <span class="token annotation punctuation">@Signature</span><span class="token punctuation">(</span>type <span class="token operator">=</span> Executor<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">"query"</span><span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{</span> MappedStatement<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> RowBounds<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> ResultHandler<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span> 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Invocation invocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span> 
        <span class="token comment" spellcheck="true">// 指定拦截处理方法</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> </code></pre>
<p>例如 MybatisPlusInterceptor 拦截器，但是默认是没有注册为 bean 的，如果我们需要分页功能，那还得手动将他进行注册<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720624879769-5108cc05-ca7f-427b-8379-f40539d0fd36.png" alt="image.png" loading="lazy"></p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> MybatisPlusInterceptor <span class="token function">mybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment" spellcheck="true">// 创建 Mybatis 拦截器</span>
    MybatisPlusInterceptor interceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 为拦截器添加插件</span>
    interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">(</span>DbType<span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> interceptor<span class="token punctuation">;</span>
<span class="token punctuation">}</span> </code></pre>
<h3 id="生效过程"><a href="#生效过程" class="headerlink" title="生效过程"></a>生效过程</h3><p>1、基于前面，我们知道每次使用 mybatis 进行 curd 操作的时候都会使用 factory 创建 sqlSession，同时使用 configuration 创建执行器 executor<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625698705-ca341f49-481b-41a4-bf32-fab19c8cc5a7.png" alt="image.png" loading="lazy"><br>2、在 MybatisConfiguration 创建 executor 的时候就会调用 interceptorChain 拦截器链进行装饰<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625760614-aa73e052-eb64-49d6-888a-cd43521cffc1.png" alt="image.png" loading="lazy"><br>3、遍历拦截器链中的拦截器进行装饰（代理）<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625855088-69057039-1457-4aaa-a171-959a7b52d5c0.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625910882-5ff18ad1-9e58-481b-913f-38ea69bb9391.png" alt="image.png" loading="lazy"><br>4、相当于就是使用 interceptor 创建了执行器的代理对象，在调用 executor 方法的时候进行拦截，执行拦截器的方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720625956481-f65334db-c08d-4268-aa8c-dbc43712f04c.png" alt="image.png" loading="lazy"><br>5、在 getSignatureMap 方法就会判断拦截器上是否具有 @Intercepts 注解，并获取其拦截的类和方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626692585-8dbf3132-e5b1-4294-a904-742967d96a31.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626778060-0d9b9005-2d26-4d69-b713-f522b150d7c4.png" alt="image.png" loading="lazy"><br>6、因为 Plugin 本身也是拦截器，代理对象的拦截器也指定了是 Plugin，所以每次调用执行器的方法的时候都会经过 Plugin 拦截，然后再判断是否调用拦截器链中的方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720627101392-18ffbeb2-e3f8-4cef-9b65-c9e9883a6252.png" alt="image.png" loading="lazy"></p>
<h3 id="拦截器链"><a href="#拦截器链" class="headerlink" title="拦截器链"></a>拦截器链</h3><p>1、拦截器链内容的添加是通过调用 Configuration 的 addInterceptor 方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626108687-a6708956-ee7e-4ced-a09c-7a731d6a2254.png" alt="image.png" loading="lazy"><br>2、而这个方法在 MybatisSqlSessionFactoryBean 的 buildSqlSessionFactory 方法中调用，用于构造 sqlSessionFactory 工厂，而这里的 plugins 就是我们配置的拦截器<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626245507-ec113717-42f7-4ed5-9dd1-6f1f04745e6b.png" alt="image.png" loading="lazy"><br>3、在 SpringBoot 自动创建 SqlSessionFactory 的时候就会设置上 plugins，而其中的 interceptors 则是依赖注入进来的，所以我们只需要将自己的拦截器注册到 ioc 容器中就能生效了<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626472115-54c9436d-905c-430a-8631-0a5cedc729a0.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720626539117-9e14fc68-123a-4927-98e4-676f9b318e63.png" alt="image.png" loading="lazy"></p>
<h3 id="MyBatisPlus-拦截器"><a href="#MyBatisPlus-拦截器" class="headerlink" title="MyBatisPlus 拦截器"></a>MyBatisPlus 拦截器</h3><p>1、MyBatisPlus 提供了一个 拦截器，我们只需要将他注册为 bean，并往这个拦截器中继续添加内部即可<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720673891566-89af2487-6ba3-4120-9da9-58cfb9c3edbd.png" alt="image.png" loading="lazy"><br>2、配置之后 MyBatisPlus 拦截器会在查询和更新数据库之前调用内部拦截器的方法<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674000991-e7041f02-dc1d-4f35-8cb0-4920263b3c53.png" alt="image.png" loading="lazy"><br>3、分页插件用法如下，就是注册 myBatisPlus 拦截器并添加内部拦截器</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 添加MP插件到Spring容器中
 *
 * @return
 */</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> MybatisPlusInterceptor <span class="token function">mybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    MybatisPlusInterceptor interceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// 分页插件</span>
    interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">(</span>DbType<span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> interceptor<span class="token punctuation">;</span>
<span class="token punctuation">}</span> </code></pre>
<p>4、同样我们只需要创建 InnerInterceptor 内部拦截器的实现类也可以添加到拦截器中<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674105197-028ba40f-224d-4cd1-9eee-dd3e47168d2b.png" alt="image.png" loading="lazy"><br>5、而 MyBatisPlus 就是通过这个 PaginationInnerInterceptor 内部拦截器进行 selectCount 和 分页 操作</p>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p>1、MyBatisPlus 在进行分页查询之前会先调用内部拦截器的方法，判断内容是否为空<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674352825-09201b1f-eea2-4296-88a5-b4f56fd3dc67.png" alt="image.png" loading="lazy"><br>2、通过 PaginationInnerInterceptor 内部拦截器查询数量<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674468034-d97d492f-0327-463b-ab11-ad9447b0eb9b.png" alt="image.png" loading="lazy"><br>3、根据 countId 获取对应的 statement<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674642515-baba32d4-b57a-4ed1-9bc7-42fe4e0e41d7.png" alt="image.png" loading="lazy"><br>4、如果未设置 countId，则会根据查询内容构造数量查询语句<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674871348-5b430c55-5a8f-45e2-bd80-a45dfbce4fd9.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674922166-061bb772-fe95-4888-9401-5fb85e36e417.png" alt="image.png" loading="lazy"><br>5、countId 的用法如下，只需要在分页对象 Page 中指定即可<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720674980291-9294a95e-5653-400f-99b9-1259c28cea40.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675029147-a75455c7-cf3e-4314-8cd4-3123d9ac9a2e.png" alt="image.png" loading="lazy"><br>6、如果查询结果数量为空则直接返回 false，不再继续进行数据库查询<br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675048047-1c4cd731-9806-43ff-99af-04183e8bf211.png" alt="image.png" loading="lazy"><br><img src="/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/1720675061337-477447b0-2cd9-4c9e-9d4d-c0c09ee20be6.png" alt="image.png" loading="lazy"></p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33129875/article/details/129304204?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171984524316800185886561%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171984524316800185886561&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-129304204-null-null.142%5Ev100%5Epc_search_result_base9&utm_term=mybatis%E9%9D%A2%E8%AF%95%E9%A2%98&spm=1018.2226.3001.4187">MyBatis常见面试题汇总（超详细回答）_mybatis面试题-CSDN博客</a></p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">谢谢光临~</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>晓江</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/" title="MybatisPlus 源码">https://lxjblog.gitee.io/2024/07/12/MybatisPlus%20%E6%BA%90%E7%A0%81/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2024/07/12/Springboot%E6%BA%90%E7%A0%81/" rel="prev" title="SpringBoot 源码"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">SpringBoot 源码</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/07/11/SpringCloud%E9%85%8D%E7%BD%AE/" rel="next" title="SpringCloud 配置"><span class="post-nav-text">SpringCloud 配置</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>可以直接写评论内容喔~</span><br></div><div id="valine-container"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>function initValine() {
  const valineConfig = {"enable":true,"appId":"71BKFg13iJQvNsFNLGzHmK67-gzGzoHsz","appKey":"IiQx2mfEEjefvbUfSd66nBHd","placeholder":"留下你的评论呗","avatar":"robohash","pageSize":10,"visitor":false,"highlight":true,"recordIP":false,"enableQQ":true,"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = window.location.pathname
  new Valine(valineConfig)
}
setTimeout(initValine, 1000)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2024 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 晓江</span></div><div class="live_time"><span>本博客已运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>const a = 1;
function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2020-08-04T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div><script>let date = new Date();
let today = (date.getMonth() + 1) + "-" + date.getDate()
if ("4-4,9-18".indexOf(today) !== -1) {
  document.documentElement.style.filter = "grayscale(1)";
}</script><div class="aplayer no-destroy" id="aplayer" data-id="5157675042" data-server="netease" data-type="playlist" data-fixed="true" data-theme="#0078E7" data-loop="all" data-order="random" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="1" data-listmaxheight="340px" data-storagename="metingjs"></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>